<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 ì „ë„ì¸ ìˆ˜ë ¨íšŒ ì°¨ëŸ‰ìš´ì˜</title>
    
    <!-- CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        body { 
            font-family: 'Pretendard', sans-serif;
            -webkit-tap-highlight-color: transparent;
            letter-spacing: -0.02em;
            background-color: #f8fafc;
        }
        .bus-container {
            background: #ffffff;
            border: 4px solid #e2e8f0;
            border-radius: 40px;
            padding: 20px;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            position: relative;
        }
        /* í° ê¸€ì ëª¨ë“œ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš© */
        .large-font .seat { height: 56px; font-size: 18px !important; font-weight: 900 !important; color: #000 !important; }
        .large-font h1 { font-size: 3.5rem !important; }
        .large-font h2 { font-size: 2.5rem !important; }
        .large-font h3 { font-size: 1.8rem !important; }
        .large-font .text-xs { font-size: 1rem !important; }
        .large-font .text-sm { font-size: 1.2rem !important; }
        .large-font .bus-container { border-width: 6px; }

        .bus-head {
            height: 60px;
            border-bottom: 2px dashed #cbd5e1;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
        }
        .seat {
            width: 100%;
            height: 38px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }
        .seat-occupied {
            background-color: #FFD700; /* ê³ ëŒ€ë¹„ ë…¸ë€ìƒ‰ */
            color: #000;
            border: 2px solid #000;
            box-shadow: inset 0 -2px 0 rgba(0,0,0,0.2);
        }
        .seat-delete-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 18px;
            height: 18px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 30;
            border: 1px solid white;
        }
        .seat:hover .seat-delete-btn {
            opacity: 1;
        }
        .seat-highlight {
            background-color: #3b82f6 !important;
            color: white !important;
            border-color: #000 !important;
            transform: scale(1.1);
            z-index: 20;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.8);
        }
        .seat-empty {
            background-color: #f1f5f9;
            border: 1px solid #cbd5e1;
            color: transparent;
        }
        .aisle {
            width: 24px;
        }
        .animate-pop { animation: pop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        @media (max-width: 640px) {
            .large-font .seat { height: 48px; font-size: 16px !important; }
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; margin: 0; }
            .bus-container { box-shadow: none !important; border: 2px solid #000 !important; }
        }

        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            backdrop-filter: blur(8px);
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.2);
            border-top: 5px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1.5rem;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ ê°œì„  */
        .info-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }
        .info-table th {
            text-align: left;
            padding: 12px 16px;
            background: #f1f5f9;
            color: #475569;
            font-size: 12px;
            font-weight: 900;
            text-transform: uppercase;
        }
        .info-table td {
            padding: 16px;
            background: #fff;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
        }
        .info-table tr td:first-child { border-left: 1px solid #e2e8f0; border-radius: 12px 0 0 12px; }
        .info-table tr td:last-child { border-right: 1px solid #e2e8f0; border-radius: 0 12px 12px 0; }
        .large-font .info-table td { padding: 24px 16px; font-size: 1.2rem; font-weight: 700; }
        
        .name-edit-input {
            width: 100%;
            padding: 4px 8px;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            font-weight: 900;
            outline: none;
            background: #eff6ff;
        }
        
        .group-separator {
            height: 2px;
            background: #e2e8f0;
            margin: 12px 0;
        }
        .car-group-header {
            font-size: 10px;
            font-weight: 900;
            color: #94a3b8;
            padding: 8px 16px 4px;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        const TIME_OPTIONS = [
            '2/23(ì›”) ì˜¤ì „', '2/23(ì›”) ì˜¤í›„', '2/23(ì›”) ì €ë…',
            '2/24(í™”) ìƒˆë²½', '2/24(í™”) ì˜¤ì „', '2/24(í™”) ì˜¤í›„', '2/24(í™”) ì €ë…',
            '2/25(ìˆ˜) ì˜¤ì „'
        ];

        const generateInitialData = () => {
            const data = [];
            const addSeat = (vehicle, row, col, name) => {
                if (!name) return;
                const seatPosition = row * 4 + col;
                data.push({
                    id: `${vehicle}-${row}-${col}-${name}`,
                    name,
                    vehicleType: vehicle,
                    departure: '2/23(ì›”) ì˜¤ì „',
                    return: '2/25(ìˆ˜) ì˜¤ì „',
                    seatPosition,
                    groupId: vehicle === 'ì„ ë°œëŒ€' ? 'bus1' : vehicle === '2í˜¸ì°¨' ? 'bus2' : 'bus3'
                });
            };

            const b1_raw = [
                ["ë°•ë¯¸ìˆœ", "ë°•ìˆœ", "ì‹ íš¨ì„±", "ë°•ì˜ë¯¸"],
                ["ë°•ìŠ¹í¬", "ìœ¤ë¯¸ì• ", "ê³µí˜„ì• ", "ë…¸ë¯¼ìˆ™"],
                ["í™©ì¬í–¥", "í—ˆê²½ì‹¬", "ìµœì •ìˆ™", "ê¹€ìœ¤í¬"],
                ["ê¹€ì¸ìˆ™", "ì¡°ê´‘ìˆœ", "ë°±ì¢…ë¯¸", "ê¹€ì—°í™”"],
                ["ê¹€ì• ìˆ™", "ì´ëª…ìˆ™", "ê°•ë™í¬", "ë¬¸ì •ì˜¥"],
                ["ë°•ë³µìˆœ", "ë¬¸ì¶˜ì", "ì´ë´‰ì„", "ê¹€ìˆ™ì˜"],
                ["ê¹€ì• ë€", "ì•ˆìƒì•„", "ì´ë¯¸ê²½", "ì¥ì†Œí¬"],
                ["ì´ì€ì", "í•œì€ê²½", "ìœ¤í•˜ì§„", "ìœ¤í•˜ì¤€"],
                ["í™©ì—°ìˆ™", null, null, null]
            ];
            b1_raw.forEach((row, rIdx) => row.forEach((name, cIdx) => addSeat('ì„ ë°œëŒ€', rIdx, cIdx, name)));

            const b2_raw = [
                ["ìœ¤í•´ê¶Œ", "ë°°í˜„ê¸°", "ì–‘íšŒìˆœ", "ì´ì–‘í˜¸"],
                ["ì†¡ê¸°í˜¸", "ì„œì˜ì§„", "ì´ì¶˜ì„ ", "ê¹€ì„±ì˜¥"],
                ["ì •ë™ê·œ", "ì´ì •í¬", "ì„ì°¬ë™", "ê¹€ìˆœì¢…"],
                ["ë°•ì˜ì", "ê¹€ì§„í¬", "ì•ˆì¬í˜¸", "ê¹€ì„±í‘œ"],
                ["ê¹€ìˆ™í¬", "ì´í˜œë ¹", "ìµœì€í¬", "ì´ë¯¸ìˆ™"],
                ["ê¹€ë‹¤ìš´", "ì´ìˆœë¡€", "ì–‘í¬ê²½", "ê°•ì •ì¸"],
                ["ì–‘ë€í¬", "ì •ì˜ë€", "ê¹€ì†Œì˜", "ìë…€1"],
                ["ë…¸ì—°ë¯¸", "ì´ìˆœí¬", "ì •ìˆ˜ì§„", "ì´ë¯¸ì •"],
                ["ê¹€ì• ë€", "ì´ê°•ì(ê·€ê°€)", "ê¹€ë•ìˆœ", "ë°•ì˜ì‹¬"],
                ["ì•ˆìœ¤ë¯¸", "ìë…€1", "ê¹€ì´ìˆ™", "ë°•ì •ì•„"],
                ["ì´íš¨ì¬", "ì´íš¨ì£¼", null, null],
                ["ì´íš¨ì¤€", null, "ë°•ë¯¸í˜„", "ê¹€ìˆœìš”"]
            ];
            b2_raw.forEach((row, rIdx) => row.forEach((name, cIdx) => addSeat('2í˜¸ì°¨', rIdx, cIdx, name)));

            const b3_raw = [
                ["ì •í•´ì›…", "ì†¡í¬ìƒ", "ê¹€ê²½ë§Œ", "ë‚˜ë³‘ìƒ"],
                ["ì •ì°¬ì‚¼", "ì´ìƒêµ", "ì†êµ­í•œ", "ì†¡ì •í•œ"],
                ["ì •í˜•ìš°", "ê³ ì˜ì§„", "ê¹€ì„±ì˜¤", null],
                ["ì„œíƒœì›…", "ì´ì„±í—Œ", "ì´ì¤€ì„œ", "ì •í˜„ì§„"],
                ["ì •ì£¼ì˜", "ì–‘í˜„ì¤€", "ê³ ì˜ì„œ", "ì–‘ìœ ì§„"],
                ["ì´ì˜ˆì€", "ì¡°ì€í˜œB", "ë°°ë‹¤ë¹ˆ", "ì˜¤íƒœí¬"],
                ["ì´íš¨ì§„", null, "ê°•ì„ ë¯¸", "ì´ì„œë¦°"],
                ["ë°°ì†Œì˜", "ë°•ìœ ë¯¸", null, null]
            ];
            b3_raw.forEach((row, rIdx) => row.forEach((name, cIdx) => addSeat('3í˜¸ì°¨', rIdx, cIdx, name)));

            const privateGroups = [
                { gid: 'p1', dr: 'ë‚˜ìˆ˜ê¸ˆ', ps: ["ì´ì˜ìš±", "ì´ê²½ì• ", "ì´í˜œë ¹", "ë°•ìœ ë¯¸"], dep: '2/23(ì›”) ì €ë…', ret: '2/24(í™”) ì €ë…', note: 'ë‚˜ìˆ˜ê¸ˆS ì°¨ëŸ‰ | ê·€ê°€ì‹œ ì´í˜œë ¹, ë°•ìœ ë¯¸ ë™ìŠ¹' },
                { gid: 'p2', dr: 'ê³ í™ì„', ps: ["ì´ì² ê·€"], dep: '2/23(ì›”) ì˜¤í›„', ret: '2/24(í™”) ì €ë…', note: 'ê³ í™ì„B ì°¨ëŸ‰' },
                { gid: 'p3', dr: 'ê¹€ìš©í˜„', ps: ["ìœ¤ë¯¸ì„ ", "ì´ì˜ìˆ™", "ì´ì˜ë¡€", "ì–‘ëª…í˜¸", "ë…¸ë¯¸ë…€", "í™ìŠ¹ì£¼"], dep: '2/24(í™”) ìƒˆë²½', ret: '2/24(í™”) ì €ë…', note: 'ê¹€ìš©í˜„B ì°¨ëŸ‰' },
                { gid: 'p4', dr: 'ì´ì¢…í›ˆ', ps: [], dep: '2/23(ì›”) ì €ë…', ret: '2/24(í™”) ì €ë…', note: 'ê°œì¸ ì¶œë°œ (íšŒì‚¬)' },
                { gid: 'p5', dr: 'ì´ì •ë¯¼', ps: [], dep: '2/23(ì›”) ì˜¤ì „', ret: '2/24(í™”) ì €ë…', note: 'ê°œë³„ ì¶œë°œ' },
                { gid: 'p6', dr: 'ê¹€ì–‘í˜„', ps: [], dep: '2/23(ì›”) ì˜¤ì „', ret: '2/23(ì›”) ì €ë…', note: 'ê°œì¸ ì¶œë°œ (íšŒì‚¬)' },
                { gid: 'p7', dr: 'ê¹€ì›…ë²”', ps: [], dep: '2/23(ì›”) ì˜¤ì „', ret: '2/25(ìˆ˜) ì˜¤ì „', note: 'ê°œë³„ ì¶œë°œ' }
            ];
            privateGroups.forEach(g => {
                [g.dr, ...g.ps].forEach(name => {
                    data.push({ id: `p-${name}-${Date.now()}-${Math.random()}`, name, vehicleType: 'ê°œì¸ì°¨ëŸ‰', groupId: g.gid, isDriver: name === g.dr, departure: g.dep, return: g.ret, details: g.note });
                });
            });

            const churchGroups = [
                { gid: 'c1', type: 'ìŠ¤íƒ€ë¦¬ì•„ A', dep: '2/23(ì›”) ì˜¤ì „ 07:00', ret: '2/23(ì›”) ì €ë…', members: ["ê¹€ì„ê¶Œ", "ê¹€ì¬ì¤‘", "ìœ í˜„", "ê¹€ëŒ€ì¤‘", "ê¹€ë™ë§Œ", "ìµœì¬ì˜", "ë¬¸ë³‘ìš©"] },
                { gid: 'c2', type: 'ìŠ¤íƒ€ë ‰ìŠ¤ B', dep: '2/23(ì›”) ì €ë… 19:40', ret: '2/24(í™”) ì €ë…', members: ["ê°•ì§€ìŠ¹", "ì†í˜•í™˜", "ìµœì˜í˜„", "í™©ê·œì—°", "ë…¸ìš°ì„", "ì„œë¶€ì„", "ë¬¸ì„±í˜"] },
                { gid: 'c3', type: 'ìŠ¤íƒ€ë¦¬ì•„ C', dep: '2/24(í™”) ì €ë… 19:30', ret: '2/25(ìˆ˜) ì˜¤ì „', members: ["ì¥ì„¸í˜", "ê¹€ìƒì¤€", "ê¹€ìŠ¹ì™„", "ê¹€ìš©ì„±", "ì°¨ë™ì² ", "ê¹€ìš©ê±¸"] }
            ];
            churchGroups.forEach(g => {
                g.members.forEach(name => {
                    data.push({ id: `c-${name}-${Date.now()}-${Math.random()}`, name, vehicleType: 'êµíšŒì°¨ëŸ‰', groupId: g.gid, isDriver: false, departure: g.dep, return: g.ret, details: `${g.type} ì´ìš©` });
                });
            });

            return data;
        };

        const App = () => {
            const [data, setData] = useState([]);
            const [isAdmin, setIsAdmin] = useState(true);
            const [isLargeFont, setIsLargeFont] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedItem, setSelectedItem] = useState(null);
            const [confirmId, setConfirmId] = useState(null);
            const [isSharing, setIsSharing] = useState(false);
            
            // ì´ë¦„ ìˆ˜ì •ìš© ìƒíƒœ
            const [editingId, setEditingId] = useState(null);
            const [tempName, setTempName] = useState('');

            const busRef = useRef(null);
            const privateRef = useRef(null);
            const churchRef = useRef(null);

            const [form, setForm] = useState({ name: '', vehicle: 'ì„ ë°œëŒ€', dep: '2/23(ì›”) ì˜¤ì „', ret: '2/25(ìˆ˜) ì˜¤ì „', memo: '' });

            useEffect(() => {
                const saved = localStorage.getItem('retreat_2026_full_v10');
                setData(saved ? JSON.parse(saved) : generateInitialData());
            }, []);

            useEffect(() => {
                if (data.length > 0) localStorage.setItem('retreat_2026_full_v10', JSON.stringify(data));
            }, [data]);

            const stats = useMemo(() => ({
                b1: data.filter(p => p.vehicleType === 'ì„ ë°œëŒ€').length,
                b2: data.filter(p => p.vehicleType === '2í˜¸ì°¨').length,
                b3: data.filter(p => p.vehicleType === '3í˜¸ì°¨').length,
                priv: data.filter(p => p.vehicleType === 'ê°œì¸ì°¨ëŸ‰').length,
                church: data.filter(p => p.vehicleType === 'êµíšŒì°¨ëŸ‰').length,
            }), [data]);

            const searchResults = useMemo(() => {
                if (!searchTerm.trim()) return [];
                return data.filter(p => p.name.includes(searchTerm.trim()));
            }, [data, searchTerm]);

            const handleAdd = (e) => {
                e.preventDefault();
                if (!form.name.trim()) return;
                
                let assignedGroupId = `group-${Date.now()}`;
                let isDriver = false;

                // ë©”ëª¨(form.memo)ì— ë“œë¼ì´ë²„ ì´ë¦„ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì—¬ ê·¸ë£¹í™”
                if (form.vehicle === 'ê°œì¸ì°¨ëŸ‰' || form.vehicle === 'êµíšŒì°¨ëŸ‰') {
                    const match = data.find(p => p.vehicleType === form.vehicle && form.memo.includes(p.name) && p.isDriver);
                    if (match) {
                        assignedGroupId = match.groupId;
                    }
                    // ë§Œì•½ ë©”ëª¨ê°€ ë¹„ì–´ìˆê±°ë‚˜ ë³¸ì¸ì´ ë“œë¼ì´ë²„ì¸ ê²½ìš° ë¡œì§ (ë©”ëª¨ì— ë³¸ì¸ì´ë¦„ ì ìœ¼ë©´ ë“œë¼ì´ë²„ë¡œ ì¸ì‹)
                    if (form.memo.includes('ìš´ì „') || form.memo.includes('ë“œë¼ì´ë²„') || form.memo.includes('ì°¨ëŸ‰ì œê³µ')) {
                        isDriver = true;
                    }
                }

                const busData = data.filter(p => p.vehicleType === form.vehicle);
                let seat = 0;
                const occupied = new Set(busData.map(p => p.seatPosition));
                while (occupied.has(seat)) seat++;

                const newItem = {
                    id: `new-${Date.now()}-${Math.random()}`,
                    name: form.name.trim(),
                    vehicleType: form.vehicle,
                    departure: form.dep,
                    return: form.ret,
                    details: form.memo,
                    seatPosition: seat,
                    groupId: assignedGroupId,
                    isDriver: isDriver
                };
                setData([...data, newItem]);
                setForm({ ...form, name: '', memo: '' });
            };

            const handleNameUpdate = (id) => {
                if (!tempName.trim()) {
                    setEditingId(null);
                    return;
                }
                setData(prev => prev.map(p => p.id === id ? { ...p, name: tempName.trim() } : p));
                setEditingId(null);
            };

            const handleSharePart = async (ref, filename) => {
                if (!ref.current) return;
                setIsSharing(true);
                try {
                    const canvas = await html2canvas(ref.current, {
                        useCORS: true,
                        scale: 2,
                        backgroundColor: '#f8fafc',
                        ignoreElements: (element) => element.classList.contains('no-print')
                    });
                    const dataUrl = canvas.toDataURL('image/png');
                    const blob = await (await fetch(dataUrl)).blob();
                    const file = new File([blob], `${filename}.png`, { type: 'image/png' });

                    if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                        await navigator.share({
                            files: [file],
                            title: '2026 ì „ë„ì¸ ìˆ˜ë ¨íšŒ ì°¨ëŸ‰ë°°ì •',
                            text: `${filename} í˜„í™© ê³µìœ ë“œë¦½ë‹ˆë‹¤.`,
                        });
                    } else {
                        const link = document.createElement('a');
                        link.href = dataUrl;
                        link.download = `${filename}.png`;
                        link.click();
                    }
                } catch (err) {
                    console.error('ê³µìœ  ì‹¤íŒ¨:', err);
                } finally {
                    setIsSharing(false);
                }
            };

            const renderBus = (type) => {
                const members = data.filter(p => p.vehicleType === type);
                return (
                    <div className="bus-container animate-pop">
                        {!isLargeFont && (
                            <div className="bus-head">
                                <div className="w-10 h-10 bg-slate-200 rounded-full flex items-center justify-center text-[10px] font-black">ìš´ì „</div>
                                <div className="w-10 h-10 border-2 border-slate-200 rounded-lg flex items-center justify-center text-[10px] font-bold text-slate-300">ì…êµ¬</div>
                            </div>
                        )}
                        <h4 className="text-center font-black text-xl mb-6 text-slate-800">{type}</h4>
                        <div className="flex justify-center gap-1">
                            <div className="grid grid-cols-2 gap-1 flex-1">
                                {Array.from({ length: 12 }).map((_, r) => [0, 1].map(c => {
                                    const seatIdx = r * 4 + c;
                                    const p = members.find(m => m.seatPosition === seatIdx);
                                    const isMatch = searchTerm.trim() !== '' && p?.name.includes(searchTerm.trim());
                                    return (
                                        <div key={seatIdx} 
                                            className={`seat ${p ? 'seat-occupied' : 'seat-empty'} ${isMatch ? 'seat-highlight' : ''}`}
                                            onClick={() => p && setSelectedItem(p)}
                                        >
                                            {p?.name}
                                            {isAdmin && p && !isLargeFont && (
                                                <button onClick={(e) => { e.stopPropagation(); setConfirmId(p.id); }} className="seat-delete-btn no-print">âœ•</button>
                                            )}
                                        </div>
                                    );
                                }))}
                            </div>
                            <div className="aisle"></div>
                            <div className="grid grid-cols-2 gap-1 flex-1">
                                {Array.from({ length: 12 }).map((_, r) => [2, 3].map(c => {
                                    const seatIdx = r * 4 + c;
                                    const p = members.find(m => m.seatPosition === seatIdx);
                                    const isMatch = searchTerm.trim() !== '' && p?.name.includes(searchTerm.trim());
                                    return (
                                        <div key={seatIdx} 
                                            className={`seat ${p ? 'seat-occupied' : 'seat-empty'} ${isMatch ? 'seat-highlight' : ''}`}
                                            onClick={() => p && setSelectedItem(p)}
                                        >
                                            {p?.name}
                                            {isAdmin && p && !isLargeFont && (
                                                <button onClick={(e) => { e.stopPropagation(); setConfirmId(p.id); }} className="seat-delete-btn no-print">âœ•</button>
                                            )}
                                        </div>
                                    );
                                }))}
                            </div>
                        </div>
                    </div>
                );
            };

            const renderTable = (cat) => {
                const list = data.filter(p => p.vehicleType === cat && (searchTerm.trim() === '' || p.name.includes(searchTerm.trim())));
                if (list.length === 0 && searchTerm.trim() === '') return null;

                // ê·¸ë£¹í™” ì •ë ¬ (groupIdë³„ë¡œ ë¬¶ìŒ)
                const groupedList = [...list].sort((a, b) => a.groupId.localeCompare(b.groupId));
                
                let lastGroupId = '';

                return (
                    <div className="w-full">
                        <table className="info-table">
                            <thead>
                                <tr>
                                    <th className="w-1/4">ì„±í•¨ (í´ë¦­ ì‹œ ìˆ˜ì •)</th>
                                    <th className="w-1/4">ì¶œë°œì¼ì‹œ</th>
                                    <th className="w-1/3">ë©”ëª¨/ì°¨ëŸ‰ì •ë³´</th>
                                    {!isLargeFont && <th className="no-print w-1/12 text-center">ì‚­ì œ</th>}
                                </tr>
                            </thead>
                            <tbody>
                                {groupedList.map(p => {
                                    const showSeparator = lastGroupId !== '' && lastGroupId !== p.groupId;
                                    lastGroupId = p.groupId;
                                    
                                    return (
                                        <React.Fragment key={p.id}>
                                            {showSeparator && (
                                                <tr>
                                                    <td colSpan={4} className="p-0 border-none"><div className="group-separator"></div></td>
                                                </tr>
                                            )}
                                            <tr className="cursor-pointer hover:bg-slate-50 transition-colors">
                                                <td className="font-black text-slate-900">
                                                    {editingId === p.id ? (
                                                        <input 
                                                            autoFocus
                                                            className="name-edit-input"
                                                            value={tempName}
                                                            onChange={e => setTempName(e.target.value)}
                                                            onBlur={() => handleNameUpdate(p.id)}
                                                            onKeyDown={e => e.key === 'Enter' && handleNameUpdate(p.id)}
                                                        />
                                                    ) : (
                                                        <div className="flex items-center gap-2 group relative" onClick={(e) => { e.stopPropagation(); setEditingId(p.id); setTempName(p.name); }}>
                                                            <span className="border-b border-dotted border-slate-300">{p.name}</span>
                                                            {p.isDriver && <span className="bg-red-600 text-white text-[9px] px-1.5 py-0.5 rounded font-black">ë“œë¼ì´ë²„</span>}
                                                            <span className="opacity-0 group-hover:opacity-40 text-[9px] ml-1">âœï¸</span>
                                                        </div>
                                                    )}
                                                </td>
                                                <td className="text-blue-600 font-bold" onClick={() => setSelectedItem(p)}>{p.departure}</td>
                                                <td className="text-slate-500 font-medium" onClick={() => setSelectedItem(p)}>{p.details}</td>
                                                {!isLargeFont && (
                                                    <td className="no-print text-center">
                                                        {isAdmin && <button onClick={e => { e.stopPropagation(); setConfirmId(p.id); }} className="w-8 h-8 rounded-full bg-red-50 text-red-500 hover:bg-red-500 hover:text-white transition-all font-black">âœ•</button>}
                                                    </td>
                                                )}
                                            </tr>
                                        </React.Fragment>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                );
            };

            return (
                <div className={`max-w-6xl mx-auto px-4 py-8 pb-32 ${isLargeFont ? 'large-font' : ''}`}>
                    {isSharing && (
                        <div className="loading-overlay">
                            <div className="spinner"></div>
                            <p className="font-black text-xl animate-pulse">ì´ë¯¸ì§€ ìƒì„± ì¤‘...</p>
                        </div>
                    )}

                    <header className="flex flex-col sm:flex-row justify-between items-center mb-10 no-print gap-4">
                        <div className="text-center sm:text-left">
                            <h1 className="text-3xl font-black text-slate-900 tracking-tighter">2026 ì „ë„ì¸ ìˆ˜ë ¨íšŒ <span className="text-blue-600">ì°¨ëŸ‰ìš´ì˜</span></h1>
                            <p className="text-xs font-bold text-slate-400 uppercase tracking-widest">Evangelist Retreat Dashboard</p>
                        </div>
                        <div className="flex gap-2 flex-wrap justify-center">
                            <button onClick={() => setIsLargeFont(!isLargeFont)} className={`px-5 py-3 rounded-2xl font-black text-sm shadow-xl transition-all ${isLargeFont ? 'bg-amber-500 text-white' : 'bg-white border-2 border-slate-200 text-slate-600'}`}>
                                {isLargeFont ? 'ì¼ë°˜ ë³´ê¸°' : 'ğŸ” í¬ê²Œ ë³´ê¸°'}
                            </button>
                            <button onClick={() => setIsAdmin(!isAdmin)} className={`px-4 py-3 rounded-xl font-black text-[10px] shadow-sm transition-all ${isAdmin ? 'bg-slate-200 text-slate-600' : 'bg-slate-800 text-white'}`}>
                                {isAdmin ? 'ADMIN' : 'VIEW'}
                            </button>
                        </div>
                    </header>

                    {!isLargeFont && isAdmin && (
                        <section className="bg-white p-8 rounded-[40px] shadow-2xl border border-slate-100 mb-12 animate-pop no-print">
                            <h3 className="text-sm font-black text-slate-400 uppercase mb-6 flex items-center gap-2">
                                <span className="w-2 h-2 bg-blue-500 rounded-full"></span> ì‹ ê·œ ë°°ì • ë“±ë¡ (ë©”ëª¨ì— ë“œë¼ì´ë²„ ì´ë¦„ ì…ë ¥ ì‹œ ìë™ ì •ë ¬)
                            </h3>
                            <form onSubmit={handleAdd} className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="space-y-4">
                                    <input type="text" placeholder="ì„±í•¨" value={form.name} onChange={e => setForm({...form, name: e.target.value})} className="w-full h-14 px-6 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold outline-none" />
                                    <select value={form.vehicle} onChange={e => setForm({...form, vehicle: e.target.value})} className="w-full h-14 px-6 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold outline-none">
                                        {['ì„ ë°œëŒ€', '2í˜¸ì°¨', '3í˜¸ì°¨', 'ê°œì¸ì°¨ëŸ‰', 'êµíšŒì°¨ëŸ‰'].map(v => <option key={v}>{v}</option>)}
                                    </select>
                                </div>
                                <div className="space-y-4">
                                    <div className="flex gap-2">
                                        <select value={form.dep} onChange={e => setForm({...form, dep: e.target.value})} className="flex-1 h-14 px-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-sm">
                                            {TIME_OPTIONS.map(t => <option key={t}>{t}</option>)}
                                        </select>
                                        <select value={form.ret} onChange={e => setForm({...form, ret: e.target.value})} className="flex-1 h-14 px-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-sm">
                                            {TIME_OPTIONS.map(t => <option key={t}>{t}</option>)}
                                        </select>
                                    </div>
                                    <input type="text" placeholder="ë©”ëª¨ (ì˜ˆ: í™ê¸¸ë™B ì°¨ëŸ‰ ë™ìŠ¹, ë“œë¼ì´ë²„ ë“±)" value={form.memo} onChange={e => setForm({...form, memo: e.target.value})} className="w-full h-14 px-6 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold outline-none" />
                                </div>
                                <button className="md:col-span-2 h-16 bg-blue-600 text-white rounded-2xl font-black text-lg shadow-xl active:scale-95 transition-all">ë°°ì • ì™„ë£Œ</button>
                            </form>
                        </section>
                    )}

                    <div className="relative mb-12 group no-print">
                        <input type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì—¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì„¸ìš”..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full h-20 bg-white border-4 border-slate-100 rounded-full px-16 font-black text-xl shadow-2xl outline-none focus:border-blue-500 transition-all" />
                        <div className="absolute left-6 top-1/2 -translate-y-1/2 text-2xl opacity-20">ğŸ”</div>
                    </div>

                    <div className="flex justify-around mb-16 text-center">
                        <div><p className="text-[10px] font-black text-slate-300">ë²„ìŠ¤ í•©ê³„</p><p className="text-2xl font-black">{stats.b1+stats.b2+stats.b3}</p></div>
                        <div><p className="text-[10px] font-black text-slate-300">ê°œì¸ì°¨ëŸ‰</p><p className="text-2xl font-black text-emerald-500">{stats.priv}</p></div>
                        <div><p className="text-[10px] font-black text-slate-300">êµíšŒì°¨ëŸ‰</p><p className="text-2xl font-black text-amber-500">{stats.church}</p></div>
                    </div>

                    <section className="mb-20">
                        <div className="flex justify-between items-center mb-10 no-print">
                            <h2 className="text-2xl font-black text-slate-800 border-l-8 border-blue-500 pl-4">ğŸšŒ ë²„ìŠ¤ íƒ‘ìŠ¹ ì¢Œì„ë„</h2>
                            <button onClick={() => handleSharePart(busRef, 'ë²„ìŠ¤_ëª…ë‹¨')} className="bg-slate-900 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-lg">ë²„ìŠ¤ ëª…ë‹¨ ì €ì¥</button>
                        </div>
                        <div ref={busRef} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 p-2">
                            {renderBus('ì„ ë°œëŒ€')}{renderBus('2í˜¸ì°¨')}{renderBus('3í˜¸ì°¨')}
                        </div>
                    </section>

                    <section className="mb-20">
                        <div className="flex justify-between items-center mb-10 no-print">
                            <h2 className="text-2xl font-black text-slate-800 border-l-8 border-emerald-500 pl-4">ğŸš— ê°œì¸ì°¨ëŸ‰ í˜„í™© (ì´ë¦„ í´ë¦­ ì‹œ ìˆ˜ì •)</h2>
                            <button onClick={() => handleSharePart(privateRef, 'ê°œì¸ì°¨ëŸ‰_ëª…ë‹¨')} className="bg-emerald-600 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-lg">ê°œì¸ì°¨ëŸ‰ ì €ì¥</button>
                        </div>
                        <div ref={privateRef} className="overflow-x-auto p-2">
                            {renderTable('ê°œì¸ì°¨ëŸ‰')}
                        </div>
                    </section>

                    <section className="mb-20">
                        <div className="flex justify-between items-center mb-10 no-print">
                            <h2 className="text-2xl font-black text-slate-800 border-l-8 border-amber-500 pl-4">ğŸš êµíšŒì°¨ëŸ‰ í˜„í™©</h2>
                            <button onClick={() => handleSharePart(churchRef, 'êµíšŒì°¨ëŸ‰_ëª…ë‹¨')} className="bg-amber-600 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-lg">êµíšŒì°¨ëŸ‰ ì €ì¥</button>
                        </div>
                        <div ref={churchRef} className="overflow-x-auto p-2">
                            {renderTable('êµíšŒì°¨ëŸ‰')}
                        </div>
                    </section>

                    {confirmId && (
                        <div className="fixed inset-0 z-[300] flex items-center justify-center p-6 bg-slate-900/60 no-print">
                            <div className="bg-white w-full max-w-xs rounded-3xl overflow-hidden shadow-2xl p-8 text-center">
                                <h3 className="text-xl font-black mb-4">ì •ë§ ì‚­ì œí• ê¹Œìš”?</h3>
                                <div className="flex gap-2">
                                    <button onClick={() => setConfirmId(null)} className="flex-1 py-4 font-bold text-slate-400 bg-slate-100 rounded-xl">ì·¨ì†Œ</button>
                                    <button onClick={() => { setData(d => d.filter(p => p.id !== confirmId)); setConfirmId(null); }} className="flex-1 py-4 font-black text-white bg-red-600 rounded-xl">ì‚­ì œ</button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {selectedItem && (
                        <div className="fixed inset-0 z-[150] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md no-print" onClick={() => setSelectedItem(null)}>
                            <div className="bg-white w-full max-w-lg rounded-[40px] overflow-hidden shadow-2xl animate-pop" onClick={e => e.stopPropagation()}>
                                <div className={`p-10 ${selectedItem.vehicleType === 'ê°œì¸ì°¨ëŸ‰' ? 'bg-emerald-500' : selectedItem.vehicleType === 'êµíšŒì°¨ëŸ‰' ? 'bg-amber-500' : 'bg-blue-600'} text-white relative`}>
                                    <button onClick={() => setSelectedItem(null)} className="absolute top-6 right-6 w-10 h-10 flex items-center justify-center bg-black/10 rounded-full text-xl font-black">âœ•</button>
                                    <h2 className="text-5xl font-black">{selectedItem.name}</h2>
                                </div>
                                <div className="p-10 space-y-8 max-h-[60vh] overflow-y-auto">
                                    <div className="grid grid-cols-2 gap-6">
                                        <div><p className="text-[10px] font-black text-slate-300 uppercase mb-2">Departure</p><p className="text-lg font-black text-slate-800">{selectedItem.departure}</p></div>
                                        <div><p className="text-[10px] font-black text-slate-300 uppercase mb-2">Return</p><p className="text-lg font-black text-slate-800">{selectedItem.return}</p></div>
                                    </div>
                                    <div>
                                        <p className="text-[10px] font-black text-slate-300 uppercase mb-2">Vehicle Info</p>
                                        <p className="text-xl font-bold text-slate-600">{selectedItem.details || 'ì¶”ê°€ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.'}</p>
                                    </div>
                                    <button onClick={() => setSelectedItem(null)} className="w-full py-5 bg-slate-900 text-white rounded-2xl font-black">í™•ì¸</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
