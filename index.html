<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 Ï†ÑÎèÑÏù∏ ÏàòÎ†®Ìöå Ï∞®ÎüâÏö¥ÏòÅ</title>
    
    <!-- CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        body { 
            font-family: 'Pretendard', sans-serif;
            -webkit-tap-highlight-color: transparent;
            letter-spacing: -0.02em;
            background-color: #f8fafc;
        }
        .bus-container {
            background: #ffffff;
            border: 4px solid #e2e8f0;
            border-radius: 40px;
            padding: 20px;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            position: relative;
        }
        /* ÌÅ∞ Í∏ÄÏûê Î™®Îìú Ïä§ÌÉÄÏùº Í∞ïÏ†ú Ï†ÅÏö© */
        .large-font .seat { height: 56px; font-size: 18px !important; font-weight: 900 !important; color: #000 !important; }
        .large-font h1 { font-size: 3.5rem !important; }
        .large-font h2 { font-size: 2.5rem !important; }
        .large-font h3 { font-size: 1.8rem !important; }
        .large-font .text-xs { font-size: 1rem !important; }
        .large-font .text-sm { font-size: 1.2rem !important; }
        .large-font .bus-container { border-width: 6px; }

        .bus-head {
            height: 60px;
            border-bottom: 2px dashed #cbd5e1;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
        }
        .seat {
            width: 100%;
            height: 38px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }
        .seat-occupied {
            background-color: #FFD700; /* Í≥†ÎåÄÎπÑ ÎÖ∏ÎûÄÏÉâ */
            color: #000;
            border: 2px solid #000;
            box-shadow: inset 0 -2px 0 rgba(0,0,0,0.2);
        }
        .seat-delete-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 18px;
            height: 18px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 30;
            border: 1px solid white;
        }
        .seat:hover .seat-delete-btn {
            opacity: 1;
        }
        .seat-highlight {
            background-color: #3b82f6 !important;
            color: white !important;
            border-color: #000 !important;
            transform: scale(1.1);
            z-index: 20;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.8);
        }
        .seat-empty {
            background-color: #f1f5f9;
            border: 1px solid #cbd5e1;
            color: transparent;
        }
        .aisle {
            width: 24px;
        }
        .animate-pop { animation: pop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        @media (max-width: 640px) {
            .large-font .seat { height: 48px; font-size: 16px !important; }
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; margin: 0; }
            .bus-container { box-shadow: none !important; border: 2px solid #000 !important; }
        }

        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            backdrop-filter: blur(8px);
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.2);
            border-top: 5px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1.5rem;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ÌÖåÏù¥Î∏î Ïä§ÌÉÄÏùº Í∞úÏÑ† */
        .info-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }
        .info-table th {
            text-align: left;
            padding: 12px 16px;
            background: #f1f5f9;
            color: #475569;
            font-size: 12px;
            font-weight: 900;
            text-transform: uppercase;
        }
        .info-table td {
            padding: 16px;
            background: #fff;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
        }
        .info-table tr td:first-child { border-left: 1px solid #e2e8f0; border-radius: 12px 0 0 12px; }
        .info-table tr td:last-child { border-right: 1px solid #e2e8f0; border-radius: 0 12px 12px 0; }
        .large-font .info-table td { padding: 24px 16px; font-size: 1.2rem; font-weight: 700; }
        
        .name-edit-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #3b82f6;
            border-radius: 12px;
            font-weight: 900;
            outline: none;
            background: #eff6ff;
            font-size: 14px;
        }
        
        .group-separator {
            height: 2px;
            background: #e2e8f0;
            margin: 12px 0;
        }
        .car-group-header {
            font-size: 10px;
            font-weight: 900;
            color: #94a3b8;
            padding: 8px 16px 4px;
            text-transform: uppercase;
        }
        .action-btn {
            padding: 6px 10px;
            border-radius: 10px;
            font-weight: 900;
            font-size: 11px;
            transition: all 0.2s;
        }
        .save-btn { background: #10b981; color: white; }
        .cancel-btn { background: #94a3b8; color: white; }
        .add-passenger-btn { background: #3b82f6; color: white; margin-left: 8px; font-size: 10px; padding: 2px 6px; border-radius: 6px; }
    </style>
</head>
<body class="text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        const TIME_OPTIONS = [
            '2/23(Ïõî) Ïò§Ï†Ñ', '2/23(Ïõî) Ïò§ÌõÑ', '2/23(Ïõî) Ï†ÄÎÖÅ',
            '2/24(Ìôî) ÏÉàÎ≤Ω', '2/24(Ìôî) Ïò§Ï†Ñ', '2/24(Ìôî) Ïò§ÌõÑ', '2/24(Ìôî) Ï†ÄÎÖÅ',
            '2/25(Ïàò) Ïò§Ï†Ñ'
        ];

        const generateInitialData = () => {
            const data = [];
            const addSeat = (vehicle, row, col, name) => {
                if (!name) return;
                const seatPosition = row * 4 + col;
                data.push({
                    id: `${vehicle}-${row}-${col}-${name}-${Math.random()}`,
                    name,
                    vehicleType: vehicle,
                    departure: '2/23(Ïõî) Ïò§Ï†Ñ',
                    return: '2/25(Ïàò) Ïò§Ï†Ñ',
                    seatPosition,
                    groupId: vehicle === 'ÏÑ†Î∞úÎåÄ' ? 'bus1' : vehicle === '2Ìò∏Ï∞®' ? 'bus2' : 'bus3'
                });
            };

            const b1_raw = [
                ["Î∞ïÎØ∏Ïàú", "Î∞ïÏàú", "Ïã†Ìö®ÏÑ±", "Î∞ïÏòÅÎØ∏"],
                ["Î∞ïÏäπÌù¨", "Ïú§ÎØ∏Ïï†", "Í≥µÌòÑÏï†", "ÎÖ∏ÎØºÏàô"],
                ["Ìô©Ïû¨Ìñ•", "ÌóàÍ≤ΩÏã¨", "ÏµúÏ†ïÏàô", "ÍπÄÏú§Ìù¨"],
                ["ÍπÄÏù∏Ïàô", "Ï°∞Í¥ëÏàú", "Î∞±Ï¢ÖÎØ∏", "ÍπÄÏó∞Ìôî"],
                ["ÍπÄÏï†Ïàô", "Ïù¥Î™ÖÏàô", "Í∞ïÎèôÌù¨", "Î¨∏Ï†ïÏò•"],
                ["Î∞ïÎ≥µÏàú", "Î¨∏Ï∂òÏûê", "Ïù¥Î¥âÏûÑ", "ÍπÄÏàôÏòÅ"],
                ["ÍπÄÏï†ÎûÄ", "ÏïàÏÉÅÏïÑ", "Ïù¥ÎØ∏Í≤Ω", "Ïû•ÏÜåÌù¨"],
                ["Ïù¥ÏùÄÏûê", "ÌïúÏùÄÍ≤Ω", "Ïú§ÌïòÏßÑ", "Ïú§ÌïòÏ§Ä"],
                ["Ìô©Ïó∞Ïàô", null, null, null]
            ];
            b1_raw.forEach((row, rIdx) => row.forEach((name, cIdx) => addSeat('ÏÑ†Î∞úÎåÄ', rIdx, cIdx, name)));

            const b2_raw = [
                ["Ïú§Ìï¥Í∂å", "Î∞∞ÌòÑÍ∏∞", "ÏñëÌöåÏàú", "Ïù¥ÏñëÌò∏"],
                ["ÏÜ°Í∏∞Ìò∏", "ÏÑúÏòÅÏßÑ", "Ïù¥Ï∂òÏÑ†", "ÍπÄÏÑ±Ïò•"],
                ["Ï†ïÎèôÍ∑ú", "Ïù¥Ï†ïÌù¨", "ÏûÑÏ∞¨Îèô", "ÍπÄÏàúÏ¢Ö"],
                ["Î∞ïÏòÅÏûê", "ÍπÄÏßÑÌù¨", "ÏïàÏû¨Ìò∏", "ÍπÄÏÑ±Ìëú"],
                ["ÍπÄÏàôÌù¨", "Ïù¥ÌòúÎ†π", "ÏµúÏùÄÌù¨", "Ïù¥ÎØ∏Ïàô"],
                ["ÍπÄÎã§Ïö¥", "Ïù¥ÏàúÎ°Ä", "ÏñëÌù¨Í≤Ω", "Í∞ïÏ†ïÏù∏"],
                ["ÏñëÎûÄÌù¨", "Ï†ïÏòÅÎûÄ", "ÍπÄÏÜåÏòÅ", "ÏûêÎÖÄ1"],
                ["ÎÖ∏Ïó∞ÎØ∏", "Ïù¥ÏàúÌù¨", "Ï†ïÏàòÏßÑ", "Ïù¥ÎØ∏Ï†ï"],
                ["ÍπÄÏï†ÎûÄ", "Ïù¥Í∞ïÏûê(Í∑ÄÍ∞Ä)", "ÍπÄÎçïÏàú", "Î∞ïÏòÅÏã¨"],
                ["ÏïàÏú§ÎØ∏", "ÏûêÎÖÄ1", "ÍπÄÏù¥Ïàô", "Î∞ïÏ†ïÏïÑ"],
                ["Ïù¥Ìö®Ïû¨", "Ïù¥Ìö®Ï£º", null, null],
                ["Ïù¥Ìö®Ï§Ä", null, "Î∞ïÎØ∏ÌòÑ", "ÍπÄÏàúÏöî"]
            ];
            b2_raw.forEach((row, rIdx) => row.forEach((name, cIdx) => addSeat('2Ìò∏Ï∞®', rIdx, cIdx, name)));

            const b3_raw = [
                ["Ï†ïÌï¥ÏõÖ", "ÏÜ°Ìù¨ÏÉÅ", "ÍπÄÍ≤ΩÎßå", "ÎÇòÎ≥ëÏÉÅ"],
                ["Ï†ïÏ∞¨ÏÇº", "Ïù¥ÏÉÅÍµê", "ÏÜçÍµ≠Ìïú", "ÏÜ°Ï†ïÌïú"],
                ["Ï†ïÌòïÏö∞", "Í≥†ÏòÅÏßÑ", "ÍπÄÏÑ±Ïò§", null],
                ["ÏÑúÌÉúÏõÖ", "Ïù¥ÏÑ±Ìóå", "Ïù¥Ï§ÄÏÑú", "Ï†ïÌòÑÏßÑ"],
                ["Ï†ïÏ£ºÏòÅ", "ÏñëÌòÑÏ§Ä", "Í≥†ÏòÅÏÑú", "ÏñëÏú†ÏßÑ"],
                ["Ïù¥ÏòàÏùÄ", "Ï°∞ÏùÄÌòúB", "Î∞∞Îã§Îπà", "Ïò§ÌÉúÌù¨"],
                ["Ïù¥Ìö®ÏßÑ", null, "Í∞ïÏÑ†ÎØ∏", "Ïù¥ÏÑúÎ¶∞"],
                ["Î∞∞ÏÜåÏòÅ", "Î∞ïÏú†ÎØ∏", null, null]
            ];
            b3_raw.forEach((row, rIdx) => row.forEach((name, cIdx) => addSeat('3Ìò∏Ï∞®', rIdx, cIdx, name)));

            const privateGroups = [
                { gid: 'p1', dr: 'ÎÇòÏàòÍ∏à', ps: ["Ïù¥ÏòÅÏö±", "Ïù¥Í≤ΩÏï†", "Ïù¥ÌòúÎ†π", "Î∞ïÏú†ÎØ∏"], dep: '2/23(Ïõî) Ï†ÄÎÖÅ', ret: '2/24(Ìôî) Ï†ÄÎÖÅ', note: 'ÎÇòÏàòÍ∏àS Ï∞®Îüâ | Í∑ÄÍ∞ÄÏãú Ïù¥ÌòúÎ†π, Î∞ïÏú†ÎØ∏ ÎèôÏäπ' },
                { gid: 'p2', dr: 'Í≥†ÌôçÏÑù', ps: ["Ïù¥Ï≤†Í∑Ä"], dep: '2/23(Ïõî) Ïò§ÌõÑ', ret: '2/24(Ìôî) Ï†ÄÎÖÅ', note: 'Í≥†ÌôçÏÑùB Ï∞®Îüâ' },
                { gid: 'p3', dr: 'ÍπÄÏö©ÌòÑ', ps: ["Ïú§ÎØ∏ÏÑ†", "Ïù¥ÏòÅÏàô", "Ïù¥ÏòÅÎ°Ä", "ÏñëÎ™ÖÌò∏", "ÎÖ∏ÎØ∏ÎÖÄ", "ÌôçÏäπÏ£º"], dep: '2/24(Ìôî) ÏÉàÎ≤Ω', ret: '2/24(Ìôî) Ï†ÄÎÖÅ', note: 'ÍπÄÏö©ÌòÑB Ï∞®Îüâ' },
                { gid: 'p4', dr: 'Ïù¥Ï¢ÖÌõà', ps: [], dep: '2/23(Ïõî) Ï†ÄÎÖÅ', ret: '2/24(Ìôî) Ï†ÄÎÖÅ', note: 'Í∞úÏù∏ Ï∂úÎ∞ú (ÌöåÏÇ¨)' },
                { gid: 'p5', dr: 'Ïù¥Ï†ïÎØº', ps: [], dep: '2/23(Ïõî) Ïò§Ï†Ñ', ret: '2/24(Ìôî) Ï†ÄÎÖÅ', note: 'Í∞úÎ≥Ñ Ï∂úÎ∞ú' },
                { gid: 'p6', dr: 'ÍπÄÏñëÌòÑ', ps: [], dep: '2/23(Ïõî) Ïò§Ï†Ñ', ret: '2/23(Ïõî) Ï†ÄÎÖÅ', note: 'Í∞úÏù∏ Ï∂úÎ∞ú (ÌöåÏÇ¨)' },
                { gid: 'p7', dr: 'ÍπÄÏõÖÎ≤î', ps: [], dep: '2/23(Ïõî) Ïò§Ï†Ñ', ret: '2/25(Ïàò) Ïò§Ï†Ñ', note: 'Í∞úÎ≥Ñ Ï∂úÎ∞ú' }
            ];
            privateGroups.forEach(g => {
                [g.dr, ...g.ps].forEach(name => {
                    data.push({ id: `p-${name}-${Date.now()}-${Math.random()}`, name, vehicleType: 'Í∞úÏù∏Ï∞®Îüâ', groupId: g.gid, isDriver: name === g.dr, departure: g.dep, return: g.ret, details: g.note });
                });
            });

            return data;
        };

        const App = () => {
            const [data, setData] = useState([]);
            const [isAdmin, setIsAdmin] = useState(true);
            const [isLargeFont, setIsLargeFont] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedItem, setSelectedItem] = useState(null);
            const [confirmId, setConfirmId] = useState(null);
            const [isSharing, setIsSharing] = useState(false);
            
            // ÏàòÏ†ïÏö© ÌÜµÌï© ÏÉÅÌÉú
            const [editingId, setEditingId] = useState(null);
            const [editForm, setEditForm] = useState({ name: '', departure: '', return: '', details: '' });

            const busRef = useRef(null);
            const privateRef = useRef(null);
            const churchRef = useRef(null);

            const [form, setForm] = useState({ name: '', vehicle: 'ÏÑ†Î∞úÎåÄ', dep: '2/23(Ïõî) Ïò§Ï†Ñ', ret: '2/25(Ïàò) Ïò§Ï†Ñ', memo: '' });

            useEffect(() => {
                const saved = localStorage.getItem('retreat_2026_full_v11');
                setData(saved ? JSON.parse(saved) : generateInitialData());
            }, []);

            useEffect(() => {
                if (data.length > 0) localStorage.setItem('retreat_2026_full_v11', JSON.stringify(data));
            }, [data]);

            const stats = useMemo(() => ({
                b1: data.filter(p => p.vehicleType === 'ÏÑ†Î∞úÎåÄ').length,
                b2: data.filter(p => p.vehicleType === '2Ìò∏Ï∞®').length,
                b3: data.filter(p => p.vehicleType === '3Ìò∏Ï∞®').length,
                priv: data.filter(p => p.vehicleType === 'Í∞úÏù∏Ï∞®Îüâ').length,
                church: data.filter(p => p.vehicleType === 'ÍµêÌöåÏ∞®Îüâ').length,
            }), [data]);

            const searchResults = useMemo(() => {
                if (!searchTerm.trim()) return [];
                return data.filter(p => p.name.includes(searchTerm.trim()));
            }, [data, searchTerm]);

            const handleAdd = (e) => {
                e.preventDefault();
                if (!form.name.trim()) return;
                
                let assignedGroupId = `group-${Date.now()}`;
                let isDriver = false;

                if (form.vehicle === 'Í∞úÏù∏Ï∞®Îüâ' || form.vehicle === 'ÍµêÌöåÏ∞®Îüâ') {
                    const match = data.find(p => p.vehicleType === form.vehicle && form.memo.includes(p.name) && p.isDriver);
                    if (match) {
                        assignedGroupId = match.groupId;
                    }
                    if (form.memo.includes('Ïö¥Ï†Ñ') || form.memo.includes('ÎìúÎùºÏù¥Î≤Ñ') || form.memo.includes('Ï∞®ÎüâÏ†úÍ≥µ')) {
                        isDriver = true;
                    }
                }

                const busData = data.filter(p => p.vehicleType === form.vehicle);
                let seat = 0;
                const occupied = new Set(busData.map(p => p.seatPosition));
                while (occupied.has(seat)) seat++;

                const newItem = {
                    id: `new-${Date.now()}-${Math.random()}`,
                    name: form.name.trim(),
                    vehicleType: form.vehicle,
                    departure: form.dep,
                    return: form.ret,
                    details: form.memo,
                    seatPosition: seat,
                    groupId: assignedGroupId,
                    isDriver: isDriver
                };
                setData([...data, newItem]);
                setForm({ ...form, name: '', memo: '' });
                // ÏµúÏÉÅÎã®ÏúºÎ°ú Ïä§ÌÅ¨Î°§ Ïù¥ÎèôÌïòÏó¨ ÌôïÏù∏ Í∞ÄÎä•ÌïòÍ≤å Ìï®
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const startEditing = (p) => {
                setEditingId(p.id);
                setEditForm({ name: p.name, departure: p.departure, return: p.return, details: p.details || '' });
            };

            const handleUpdateRow = (id) => {
                setData(prev => prev.map(p => p.id === id ? { ...p, ...editForm } : p));
                setEditingId(null);
            };

            const addPassengerToDriver = (driver) => {
                setForm({
                    ...form,
                    vehicle: driver.vehicleType,
                    dep: driver.departure,
                    ret: driver.return,
                    memo: `${driver.name} Ï∞®Îüâ ÎèôÏäπ`
                });
                // ÏûÖÎ†• ÌïÑÎìú Ï™ΩÏúºÎ°ú Ìè¨Ïª§Ïä§
                document.querySelector('input[placeholder="ÏÑ±Ìï®"]')?.focus();
                window.scrollTo({ top: 200, behavior: 'smooth' });
            };

            const handleSharePart = async (ref, filename) => {
                if (!ref.current) return;
                setIsSharing(true);
                try {
                    const canvas = await html2canvas(ref.current, {
                        useCORS: true,
                        scale: 2,
                        backgroundColor: '#f8fafc',
                        ignoreElements: (element) => element.classList.contains('no-print')
                    });
                    const dataUrl = canvas.toDataURL('image/png');
                    const blob = await (await fetch(dataUrl)).blob();
                    const file = new File([blob], `${filename}.png`, { type: 'image/png' });

                    if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                        await navigator.share({
                            files: [file],
                            title: '2026 Ï†ÑÎèÑÏù∏ ÏàòÎ†®Ìöå Ï∞®ÎüâÎ∞∞Ï†ï',
                            text: `${filename} ÌòÑÌô© Í≥µÏú†ÎìúÎ¶ΩÎãàÎã§.`,
                        });
                    } else {
                        const link = document.createElement('a');
                        link.href = dataUrl;
                        link.download = `${filename}.png`;
                        link.click();
                    }
                } catch (err) {
                    console.error('Í≥µÏú† Ïã§Ìå®:', err);
                } finally {
                    setIsSharing(false);
                }
            };

            const renderBus = (type) => {
                const members = data.filter(p => p.vehicleType === type);
                return (
                    <div className="bus-container animate-pop">
                        {!isLargeFont && (
                            <div className="bus-head">
                                <div className="w-10 h-10 bg-slate-200 rounded-full flex items-center justify-center text-[10px] font-black">Ïö¥Ï†Ñ</div>
                                <div className="w-10 h-10 border-2 border-slate-200 rounded-lg flex items-center justify-center text-[10px] font-bold text-slate-300">ÏûÖÍµ¨</div>
                            </div>
                        )}
                        <h4 className="text-center font-black text-xl mb-6 text-slate-800">{type}</h4>
                        <div className="flex justify-center gap-1">
                            <div className="grid grid-cols-2 gap-1 flex-1">
                                {Array.from({ length: 12 }).map((_, r) => [0, 1].map(c => {
                                    const seatIdx = r * 4 + c;
                                    const p = members.find(m => m.seatPosition === seatIdx);
                                    const isMatch = searchTerm.trim() !== '' && p?.name.includes(searchTerm.trim());
                                    return (
                                        <div key={seatIdx} 
                                            className={`seat ${p ? 'seat-occupied' : 'seat-empty'} ${isMatch ? 'seat-highlight' : ''}`}
                                            onClick={() => p && setSelectedItem(p)}
                                        >
                                            {p?.name}
                                            {isAdmin && p && !isLargeFont && (
                                                <button onClick={(e) => { e.stopPropagation(); setConfirmId(p.id); }} className="seat-delete-btn no-print">‚úï</button>
                                            )}
                                        </div>
                                    );
                                }))}
                            </div>
                            <div className="aisle"></div>
                            <div className="grid grid-cols-2 gap-1 flex-1">
                                {Array.from({ length: 12 }).map((_, r) => [2, 3].map(c => {
                                    const seatIdx = r * 4 + c;
                                    const p = members.find(m => m.seatPosition === seatIdx);
                                    const isMatch = searchTerm.trim() !== '' && p?.name.includes(searchTerm.trim());
                                    return (
                                        <div key={seatIdx} 
                                            className={`seat ${p ? 'seat-occupied' : 'seat-empty'} ${isMatch ? 'seat-highlight' : ''}`}
                                            onClick={() => p && setSelectedItem(p)}
                                        >
                                            {p?.name}
                                            {isAdmin && p && !isLargeFont && (
                                                <button onClick={(e) => { e.stopPropagation(); setConfirmId(p.id); }} className="seat-delete-btn no-print">‚úï</button>
                                            )}
                                        </div>
                                    );
                                }))}
                            </div>
                        </div>
                    </div>
                );
            };

            const renderTable = (cat) => {
                const list = data.filter(p => p.vehicleType === cat && (searchTerm.trim() === '' || p.name.includes(searchTerm.trim())));
                if (list.length === 0 && searchTerm.trim() === '') return null;

                const groupedList = [...list].sort((a, b) => a.groupId.localeCompare(b.groupId) || (b.isDriver ? 1 : -1));
                let lastGroupId = '';

                return (
                    <div className="w-full">
                        <table className="info-table">
                            <thead>
                                <tr>
                                    <th className="w-[18%]">ÏÑ±Ìï®</th>
                                    <th className="w-[18%]">Ï∂úÎ∞ú</th>
                                    <th className="w-[18%]">ÎèÑÏ∞©(Í∑ÄÍ∞Ä)</th>
                                    <th className="w-[30%]">Î©îÎ™®/Ï∞®ÎüâÏ†ïÎ≥¥</th>
                                    <th className="no-print w-[16%] text-center">Í¥ÄÎ¶¨</th>
                                </tr>
                            </thead>
                            <tbody>
                                {groupedList.map(p => {
                                    const isEditing = editingId === p.id;
                                    const showSeparator = lastGroupId !== '' && lastGroupId !== p.groupId;
                                    lastGroupId = p.groupId;
                                    
                                    return (
                                        <React.Fragment key={p.id}>
                                            {showSeparator && (
                                                <tr><td colSpan={5} className="p-0 border-none"><div className="group-separator"></div></td></tr>
                                            )}
                                            <tr className={`${isEditing ? 'bg-blue-50' : 'hover:bg-slate-50'} transition-colors`}>
                                                <td className="font-black">
                                                    {isEditing ? (
                                                        <input className="name-edit-input" value={editForm.name} onChange={e => setEditForm({...editForm, name: e.target.value})} />
                                                    ) : (
                                                        <div className="flex items-center gap-1">
                                                            <span className="text-slate-900">{p.name}</span>
                                                            {p.isDriver && (
                                                                <div className="flex items-center">
                                                                    <span className="bg-red-600 text-white text-[9px] px-1.5 py-0.5 rounded font-black">ÎìúÎùºÏù¥Î≤Ñ</span>
                                                                    <button onClick={() => addPassengerToDriver(p)} className="add-passenger-btn no-print" title="ÌÉëÏäπÏûê Ï∂îÍ∞Ä">+ ÌÉëÏäπ</button>
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </td>
                                                <td>
                                                    {isEditing ? (
                                                        <select className="name-edit-input" value={editForm.departure} onChange={e => setEditForm({...editForm, departure: e.target.value})}>
                                                            {TIME_OPTIONS.map(t => <option key={t}>{t}</option>)}
                                                        </select>
                                                    ) : <span className="text-blue-600 font-bold text-sm">{p.departure}</span>}
                                                </td>
                                                <td>
                                                    {isEditing ? (
                                                        <select className="name-edit-input" value={editForm.return} onChange={e => setEditForm({...editForm, return: e.target.value})}>
                                                            {TIME_OPTIONS.map(t => <option key={t}>{t}</option>)}
                                                        </select>
                                                    ) : <span className="text-slate-500 font-bold text-sm">{p.return}</span>}
                                                </td>
                                                <td>
                                                    {isEditing ? (
                                                        <input className="name-edit-input" value={editForm.details} onChange={e => setEditForm({...editForm, details: e.target.value})} placeholder="Ï∞®ÎüâÏ†ïÎ≥¥ ÎòêÎäî Î©îÎ™®" />
                                                    ) : <span className="text-slate-500 font-medium text-sm line-clamp-1">{p.details}</span>}
                                                </td>
                                                <td className="no-print text-center">
                                                    {isAdmin && (
                                                        <div className="flex gap-1 justify-center">
                                                            {isEditing ? (
                                                                <>
                                                                    <button onClick={() => handleUpdateRow(p.id)} className="action-btn save-btn">Ï†ÄÏû•</button>
                                                                    <button onClick={() => setEditingId(null)} className="action-btn cancel-btn">Ï∑®ÏÜå</button>
                                                                </>
                                                            ) : (
                                                                <>
                                                                    <button onClick={() => startEditing(p)} className="action-btn bg-slate-100 text-slate-600 hover:bg-slate-200">ÏàòÏ†ï</button>
                                                                    <button onClick={() => setConfirmId(p.id)} className="action-btn bg-red-50 text-red-500 hover:bg-red-500 hover:text-white">‚úï</button>
                                                                </>
                                                            )}
                                                        </div>
                                                    )}
                                                </td>
                                            </tr>
                                        </React.Fragment>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                );
            };

            return (
                <div className={`max-w-6xl mx-auto px-4 py-8 pb-32 ${isLargeFont ? 'large-font' : ''}`}>
                    {isSharing && (
                        <div className="loading-overlay">
                            <div className="spinner"></div>
                            <p className="font-black text-xl animate-pulse">Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ï§ë...</p>
                        </div>
                    )}

                    <header className="flex flex-col sm:flex-row justify-between items-center mb-10 no-print gap-4">
                        <div className="text-center sm:text-left">
                            <h1 className="text-3xl font-black text-slate-900 tracking-tighter">2026 Ï†ÑÎèÑÏù∏ ÏàòÎ†®Ìöå <span className="text-blue-600">Ï∞®ÎüâÏö¥ÏòÅ</span></h1>
                            <p className="text-xs font-bold text-slate-400 uppercase tracking-widest">Evangelist Retreat Dashboard</p>
                        </div>
                        <div className="flex gap-2 flex-wrap justify-center">
                            <button onClick={() => setIsLargeFont(!isLargeFont)} className={`px-5 py-3 rounded-2xl font-black text-sm shadow-xl transition-all ${isLargeFont ? 'bg-amber-500 text-white' : 'bg-white border-2 border-slate-200 text-slate-600'}`}>
                                {isLargeFont ? 'ÏùºÎ∞ò Î≥¥Í∏∞' : 'üîé ÌÅ¨Í≤å Î≥¥Í∏∞'}
                            </button>
                            <button onClick={() => setIsAdmin(!isAdmin)} className={`px-4 py-3 rounded-xl font-black text-[10px] shadow-sm transition-all ${isAdmin ? 'bg-slate-200 text-slate-600' : 'bg-slate-800 text-white'}`}>
                                {isAdmin ? 'ADMIN' : 'VIEW'}
                            </button>
                        </div>
                    </header>

                    {!isLargeFont && isAdmin && (
                        <section className="bg-white p-8 rounded-[40px] shadow-2xl border border-slate-100 mb-12 animate-pop no-print">
                            <h3 className="text-sm font-black text-slate-400 uppercase mb-6 flex items-center gap-2">
                                <span className="w-2 h-2 bg-blue-500 rounded-full"></span> Ïã†Í∑ú Î∞∞Ï†ï Îì±Î°ù
                            </h3>
                            <form onSubmit={handleAdd} className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="space-y-4">
                                    <input type="text" placeholder="ÏÑ±Ìï®" value={form.name} onChange={e => setForm({...form, name: e.target.value})} className="w-full h-14 px-6 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold outline-none focus:border-blue-500" />
                                    <select value={form.vehicle} onChange={e => setForm({...form, vehicle: e.target.value})} className="w-full h-14 px-6 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold outline-none">
                                        {['ÏÑ†Î∞úÎåÄ', '2Ìò∏Ï∞®', '3Ìò∏Ï∞®', 'Í∞úÏù∏Ï∞®Îüâ', 'ÍµêÌöåÏ∞®Îüâ'].map(v => <option key={v}>{v}</option>)}
                                    </select>
                                </div>
                                <div className="space-y-4">
                                    <div className="flex gap-2">
                                        <div className="flex-1">
                                            <p className="text-[10px] font-black text-slate-400 mb-1 ml-2">Ï∂úÎ∞úÏùºÏãú</p>
                                            <select value={form.dep} onChange={e => setForm({...form, dep: e.target.value})} className="w-full h-14 px-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-sm">
                                                {TIME_OPTIONS.map(t => <option key={t}>{t}</option>)}
                                            </select>
                                        </div>
                                        <div className="flex-1">
                                            <p className="text-[10px] font-black text-slate-400 mb-1 ml-2">ÎèÑÏ∞©(Í∑ÄÍ∞Ä)</p>
                                            <select value={form.ret} onChange={e => setForm({...form, ret: e.target.value})} className="w-full h-14 px-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-sm">
                                                {TIME_OPTIONS.map(t => <option key={t}>{t}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                    <input type="text" placeholder="Î©îÎ™® (Ïòà: ÌôçÍ∏∏ÎèôB Ï∞®Îüâ ÎèôÏäπ, ÎìúÎùºÏù¥Î≤Ñ Îì±)" value={form.memo} onChange={e => setForm({...form, memo: e.target.value})} className="w-full h-14 px-6 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold outline-none focus:border-emerald-500" />
                                </div>
                                <button className="md:col-span-2 h-16 bg-blue-600 text-white rounded-2xl font-black text-lg shadow-xl active:scale-95 transition-all">Î∞∞Ï†ï ÏôÑÎ£å</button>
                            </form>
                        </section>
                    )}

                    <div className="relative mb-12 group no-print">
                        <input type="text" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏó¨ ÏúÑÏπòÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full h-20 bg-white border-4 border-slate-100 rounded-full px-16 font-black text-xl shadow-2xl outline-none focus:border-blue-500 transition-all" />
                        <div className="absolute left-6 top-1/2 -translate-y-1/2 text-2xl opacity-20">üîç</div>
                    </div>

                    <div className="flex justify-around mb-16 text-center">
                        <div><p className="text-[10px] font-black text-slate-300">Î≤ÑÏä§ Ìï©Í≥Ñ</p><p className="text-2xl font-black">{stats.b1+stats.b2+stats.b3}</p></div>
                        <div><p className="text-[10px] font-black text-slate-300">Í∞úÏù∏Ï∞®Îüâ</p><p className="text-2xl font-black text-emerald-500">{stats.priv}</p></div>
                        <div><p className="text-[10px] font-black text-slate-300">ÍµêÌöåÏ∞®Îüâ</p><p className="text-2xl font-black text-amber-500">{stats.church}</p></div>
                    </div>

                    <section className="mb-20">
                        <div className="flex justify-between items-center mb-10 no-print">
                            <h2 className="text-2xl font-black text-slate-800 border-l-8 border-blue-500 pl-4">üöå Î≤ÑÏä§ ÌÉëÏäπ Ï¢åÏÑùÎèÑ</h2>
                            <button onClick={() => handleSharePart(busRef, 'Î≤ÑÏä§_Î™ÖÎã®')} className="bg-slate-900 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-lg">Î≤ÑÏä§ Î™ÖÎã® Ï†ÄÏû•</button>
                        </div>
                        <div ref={busRef} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 p-2">
                            {renderBus('ÏÑ†Î∞úÎåÄ')}{renderBus('2Ìò∏Ï∞®')}{renderBus('3Ìò∏Ï∞®')}
                        </div>
                    </section>

                    <section className="mb-20">
                        <div className="flex justify-between items-center mb-10 no-print">
                            <h2 className="text-2xl font-black text-slate-800 border-l-8 border-emerald-500 pl-4">üöó Í∞úÏù∏Ï∞®Îüâ ÌòÑÌô© (Ï†Ñ ÌïÑÎìú ÏàòÏ†ï Í∞ÄÎä•)</h2>
                            <button onClick={() => handleSharePart(privateRef, 'Í∞úÏù∏Ï∞®Îüâ_Î™ÖÎã®')} className="bg-emerald-600 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-lg">Í∞úÏù∏Ï∞®Îüâ Ï†ÄÏû•</button>
                        </div>
                        <div ref={privateRef} className="overflow-x-auto p-2">
                            {renderTable('Í∞úÏù∏Ï∞®Îüâ')}
                        </div>
                    </section>

                    <section className="mb-20">
                        <div className="flex justify-between items-center mb-10 no-print">
                            <h2 className="text-2xl font-black text-slate-800 border-l-8 border-amber-500 pl-4">üöê ÍµêÌöåÏ∞®Îüâ ÌòÑÌô©</h2>
                            <button onClick={() => handleSharePart(churchRef, 'ÍµêÌöåÏ∞®Îüâ_Î™ÖÎã®')} className="bg-amber-600 text-white px-4 py-2 rounded-xl text-[10px] font-black shadow-lg">ÍµêÌöåÏ∞®Îüâ Ï†ÄÏû•</button>
                        </div>
                        <div ref={churchRef} className="overflow-x-auto p-2">
                            {renderTable('ÍµêÌöåÏ∞®Îüâ')}
                        </div>
                    </section>

                    {confirmId && (
                        <div className="fixed inset-0 z-[300] flex items-center justify-center p-6 bg-slate-900/60 no-print">
                            <div className="bg-white w-full max-w-xs rounded-3xl overflow-hidden shadow-2xl p-8 text-center">
                                <h3 className="text-xl font-black mb-4">Ï†ïÎßê ÏÇ≠Ï†úÌï†ÍπåÏöî?</h3>
                                <div className="flex gap-2">
                                    <button onClick={() => setConfirmId(null)} className="flex-1 py-4 font-bold text-slate-400 bg-slate-100 rounded-xl">Ï∑®ÏÜå</button>
                                    <button onClick={() => { setData(d => d.filter(p => p.id !== confirmId)); setConfirmId(null); }} className="flex-1 py-4 font-black text-white bg-red-600 rounded-xl">ÏÇ≠Ï†ú</button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {selectedItem && (
                        <div className="fixed inset-0 z-[150] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md no-print" onClick={() => setSelectedItem(null)}>
                            <div className="bg-white w-full max-w-lg rounded-[40px] overflow-hidden shadow-2xl animate-pop" onClick={e => e.stopPropagation()}>
                                <div className={`p-10 ${selectedItem.vehicleType === 'Í∞úÏù∏Ï∞®Îüâ' ? 'bg-emerald-500' : selectedItem.vehicleType === 'ÍµêÌöåÏ∞®Îüâ' ? 'bg-amber-500' : 'bg-blue-600'} text-white relative`}>
                                    <button onClick={() => setSelectedItem(null)} className="absolute top-6 right-6 w-10 h-10 flex items-center justify-center bg-black/10 rounded-full text-xl font-black">‚úï</button>
                                    <h2 className="text-5xl font-black">{selectedItem.name}</h2>
                                </div>
                                <div className="p-10 space-y-8 max-h-[60vh] overflow-y-auto">
                                    <div className="grid grid-cols-2 gap-6">
                                        <div><p className="text-[10px] font-black text-slate-300 uppercase mb-2">Departure</p><p className="text-lg font-black text-slate-800">{selectedItem.departure}</p></div>
                                        <div><p className="text-[10px] font-black text-slate-300 uppercase mb-2">Return</p><p className="text-lg font-black text-slate-800">{selectedItem.return}</p></div>
                                    </div>
                                    <div>
                                        <p className="text-[10px] font-black text-slate-300 uppercase mb-2">Vehicle Info</p>
                                        <p className="text-xl font-bold text-slate-600">{selectedItem.details || 'Ï∂îÍ∞Ä Î©îÎ™®Í∞Ä ÏóÜÏäµÎãàÎã§.'}</p>
                                    </div>
                                    <button onClick={() => setSelectedItem(null)} className="w-full py-5 bg-slate-900 text-white rounded-2xl font-black">ÌôïÏù∏</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
