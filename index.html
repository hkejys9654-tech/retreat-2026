<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 ì „ë„ì¸ ìˆ˜ë ¨íšŒ ì°¨ëŸ‰ìš´ì˜</title>
    
    <!-- CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- í™”ë©´ ìº¡ì²˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        body { 
            font-family: 'Pretendard', sans-serif;
            -webkit-tap-highlight-color: transparent;
            letter-spacing: -0.02em;
            background-color: #f8fafc;
        }
        .bus-container {
            background: #ffffff;
            border: 4px solid #e2e8f0;
            border-radius: 40px;
            padding: 20px;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            position: relative;
        }
        .bus-head {
            height: 60px;
            border-bottom: 2px dashed #cbd5e1;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
        }
        .seat {
            width: 100%;
            height: 38px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }
        .seat-occupied {
            background-color: #fbbf24;
            color: #1e293b;
            border: 1px solid #d97706;
            box-shadow: inset 0 -2px 0 rgba(0,0,0,0.1);
        }
        .seat-delete-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 16px;
            height: 16px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 30;
        }
        .seat:hover .seat-delete-btn {
            opacity: 1;
        }
        .seat-highlight {
            background-color: #3b82f6 !important;
            color: white !important;
            border-color: #1d4ed8 !important;
            transform: scale(1.1);
            z-index: 20;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.6);
        }
        .seat-empty {
            background-color: #f1f5f9;
            border: 1px solid #e2e8f0;
            color: transparent;
        }
        .aisle {
            width: 24px;
        }
        .animate-pop { animation: pop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        @media (max-width: 640px) {
            .seat { height: 34px; font-size: 10px; }
            .seat-delete-btn { width: 14px; height: 14px; font-size: 8px; }
        }

        /* ì¸ì‡„ ë° ê³µìœ  ì‹œ ì‹œê°í™” ìµœì í™” */
        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; margin: 0; }
            .max-w-6xl { max-width: 100% !important; padding: 0 !important; margin: 0 !important; }
            .bus-container { 
                box-shadow: none !important; 
                border: 2px solid #ccc !important; 
                page-break-inside: avoid;
                margin-bottom: 20px;
            }
            .seat-delete-btn { display: none !important; }
            section { page-break-before: auto; }
            .grid { display: grid !important; }
        }

        /* ê³µìœ  ì¤‘ ë¡œë”© ì˜¤ë²„ë ˆì´ */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            backdrop-blur: 5px;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        const TIME_OPTIONS = [
            '2/23(ì›”) ì˜¤ì „', '2/23(ì›”) ì˜¤í›„', '2/23(ì›”) ì €ë…',
            '2/24(í™”) ìƒˆë²½', '2/24(í™”) ì˜¤ì „', '2/24(í™”) ì˜¤í›„', '2/24(í™”) ì €ë…',
            '2/25(ìˆ˜) ì˜¤ì „'
        ];

        // ì´ë¯¸ì§€ì— ëª…ì‹œëœ í–‰(row)ê³¼ ì—´(column)ì„ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„° ìƒì„±
        const generateInitialData = () => {
            const data = [];

            // ë³´ì¡° í•¨ìˆ˜: íŠ¹ì • ìœ„ì¹˜ì— ì¢Œì„ ë°°ì¹˜
            const addSeat = (vehicle, row, col, name) => {
                if (!name) return;
                const seatPosition = row * 4 + col;
                data.push({
                    id: `${vehicle}-${row}-${col}-${name}`,
                    name,
                    vehicleType: vehicle,
                    departure: '2/23(ì›”) ì˜¤ì „',
                    return: '2/25(ìˆ˜) ì˜¤ì „',
                    seatPosition,
                    groupId: vehicle === 'ì„ ë°œëŒ€' ? 'bus1' : vehicle === '2í˜¸ì°¨' ? 'bus2' : 'bus3'
                });
            };

            // ì„ ë°œëŒ€ (ì´ë¯¸ì§€ 1ì—´-4ì—´ ê¸°ì¤€)
            const b1_raw = [
                ["ë°•ë¯¸ìˆœ", "ë°•ìˆœ", "ì‹ íš¨ì„±", "ë°•ì˜ë¯¸"],
                ["ë°•ìŠ¹í¬", "ìœ¤ë¯¸ì• ", "ê³µí˜„ì• ", "ë…¸ë¯¼ìˆ™"],
                ["í™©ì¬í–¥", "í—ˆê²½ì‹¬", "ìµœì •ìˆ™", "ê¹€ìœ¤í¬"],
                ["ê¹€ì¸ìˆ™", "ì¡°ê´‘ìˆœ", "ë°±ì¢…ë¯¸", "ê¹€ì—°í™”"],
                ["ê¹€ì• ìˆ™", "ì´ëª…ìˆ™", "ê°•ë™í¬", "ë¬¸ì •ì˜¥"],
                ["ë°•ë³µìˆœ", "ë¬¸ì¶˜ì", "ì´ë´‰ì„", "ê¹€ìˆ™ì˜"],
                ["ê¹€ì• ë€", "ì•ˆìƒì•„", "ì´ë¯¸ê²½", "ì¥ì†Œí¬"],
                ["ì´ì€ì", "í•œì€ê²½", "ìœ¤í•˜ì§„", "ìœ¤í•˜ì¤€"],
                ["í™©ì—°ìˆ™", null, null, null]
            ];
            b1_raw.forEach((row, rIdx) => row.forEach((name, cIdx) => addSeat('ì„ ë°œëŒ€', rIdx, cIdx, name)));

            // 2í˜¸ì°¨ (ì´ë¯¸ì§€ ì¤‘ê°„ êµ¬ì—­ ê¸°ì¤€)
            const b2_raw = [
                ["ìœ¤í•´ê¶Œ", "ë°°í˜„ê¸°", "ì–‘íšŒìˆœ", "ì´ì–‘í˜¸"],
                ["ì†¡ê¸°í˜¸", "ì„œì˜ì§„", "ì´ì¶˜ì„ ", "ê¹€ì„±ì˜¥"],
                ["ì •ë™ê·œ", "ì´ì •í¬", "ì„ì°¬ë™", "ê¹€ìˆœì¢…"],
                ["ë°•ì˜ì", "ê¹€ì§„í¬", "ì•ˆì¬í˜¸", "ê¹€ì„±í‘œ"],
                ["ê¹€ìˆ™í¬", "ì´í˜œë ¹", "ìµœì€í¬", "ì´ë¯¸ìˆ™"],
                ["ê¹€ë‹¤ìš´", "ì´ìˆœë¡€", "ì–‘í¬ê²½", "ê°•ì •ì¸"],
                ["ì–‘ë€í¬", "ì •ì˜ë€", "ê¹€ì†Œì˜", "ìë…€1"],
                ["ë…¸ì—°ë¯¸", "ì´ìˆœí¬", "ì •ìˆ˜ì§„", "ì´ë¯¸ì •"],
                ["ê¹€ì• ë€", "ì´ê°•ì(ê·€ê°€)", "ê¹€ë•ìˆœ", "ë°•ì˜ì‹¬"],
                ["ì•ˆìœ¤ë¯¸", "ìë…€1", "ê¹€ì´ìˆ™", "ë°•ì •ì•„"],
                ["ì´íš¨ì¬", "ì´íš¨ì£¼", null, null],
                ["ì´íš¨ì¤€", null, "ë°•ë¯¸í˜„", "ê¹€ìˆœìš”"]
            ];
            b2_raw.forEach((row, rIdx) => row.forEach((name, cIdx) => addSeat('2í˜¸ì°¨', rIdx, cIdx, name)));

            // 3í˜¸ì°¨ (ì´ë¯¸ì§€ ìš°ì¸¡ êµ¬ì—­ ê¸°ì¤€)
            const b3_raw = [
                ["ì •í•´ì›…", "ì†¡í¬ìƒ", "ê¹€ê²½ë§Œ", "ë‚˜ë³‘ìƒ"],
                ["ì •ì°¬ì‚¼", "ì´ìƒêµ", "ì†êµ­í•œ", "ì†¡ì •í•œ"],
                ["ì •í˜•ìš°", "ê³ ì˜ì§„", "ê¹€ì„±ì˜¤", null],
                ["ì„œíƒœì›…", "ì´ì„±í—Œ", "ì´ì¤€ì„œ", "ì •í˜„ì§„"],
                ["ì •ì£¼ì˜", "ì–‘í˜„ì¤€", "ê³ ì˜ì„œ", "ì–‘ìœ ì§„"],
                ["ì´ì˜ˆì€", "ì¡°ì€í˜œB", "ë°°ë‹¤ë¹ˆ", "ì˜¤íƒœí¬"],
                ["ì´íš¨ì§„", null, "ê°•ì„ ë¯¸", "ì´ì„œë¦°"],
                ["ë°°ì†Œì˜", "ë°•ìœ ë¯¸", null, null]
            ];
            b3_raw.forEach((row, rIdx) => row.forEach((name, cIdx) => addSeat('3í˜¸ì°¨', rIdx, cIdx, name)));

            // ê¸°íƒ€ ì°¨ëŸ‰ ì •ë³´ (ê¸°ì¡´ ë°ì´í„° ìœ ì§€)
            const privateGroups = [
                { gid: 'p1', dr: 'ë‚˜ìˆ˜ê¸ˆ', ps: ["ì´ì˜ìš±", "ì´ê²½ì• ", "ì´í˜œë ¹", "ë°•ìœ ë¯¸"], dep: '2/23(ì›”) ì €ë…', ret: '2/24(í™”) ì €ë…', note: 'ë‚˜ìˆ˜ê¸ˆS ì°¨ëŸ‰ | ê·€ê°€ì‹œ ì´í˜œë ¹, ë°•ìœ ë¯¸ ë™ìŠ¹' },
                { gid: 'p2', dr: 'ê³ í™ì„', ps: ["ì´ì² ê·€"], dep: '2/23(ì›”) ì˜¤í›„', ret: '2/24(í™”) ì €ë…', note: 'ê³ í™ì„B ì°¨ëŸ‰' },
                { gid: 'p3', dr: 'ê¹€ìš©í˜„', ps: ["ìœ¤ë¯¸ì„ ", "ì´ì˜ìˆ™", "ì´ì˜ë¡€", "ì–‘ëª…í˜¸", "ë…¸ë¯¸ë…€", "í™ìŠ¹ì£¼"], dep: '2/24(í™”) ìƒˆë²½', ret: '2/24(í™”) ì €ë…', note: 'ê¹€ìš©í˜„B ì°¨ëŸ‰' },
                { gid: 'p4', dr: 'ì´ì¢…í›ˆ', ps: [], dep: '2/23(ì›”) ì €ë…', ret: '2/24(í™”) ì €ë…', note: 'ê°œì¸ ì¶œë°œ (íšŒì‚¬)' },
                { gid: 'p5', dr: 'ì´ì •ë¯¼', ps: [], dep: '2/23(ì›”) ì˜¤ì „', ret: '2/24(í™”) ì €ë…', note: 'ê°œë³„ ì¶œë°œ' },
                { gid: 'p6', dr: 'ê¹€ì–‘í˜„', ps: [], dep: '2/23(ì›”) ì˜¤ì „', ret: '2/23(ì›”) ì €ë…', note: 'ê°œì¸ ì¶œë°œ (íšŒì‚¬)' },
                { gid: 'p7', dr: 'ê¹€ì›…ë²”', ps: [], dep: '2/23(ì›”) ì˜¤ì „', ret: '2/25(ìˆ˜) ì˜¤ì „', note: 'ê°œë³„ ì¶œë°œ' }
            ];
            privateGroups.forEach(g => {
                [g.dr, ...g.ps].forEach(name => {
                    data.push({ id: `p-${name}`, name, vehicleType: 'ê°œì¸ì°¨ëŸ‰', groupId: g.gid, isDriver: name === g.dr, departure: g.dep, return: g.ret, details: g.note });
                });
            });

            const churchGroups = [
                { gid: 'c1', type: 'ìŠ¤íƒ€ë¦¬ì•„ A', dep: '2/23(ì›”) ì˜¤ì „ 07:00', ret: '2/23(ì›”) ì €ë…', members: ["ê¹€ì„ê¶Œ", "ê¹€ì¬ì¤‘", "ìœ í˜„", "ê¹€ëŒ€ì¤‘", "ê¹€ë™ë§Œ", "ìµœì¬ì˜", "ë¬¸ë³‘ìš©"] },
                { gid: 'c2', type: 'ìŠ¤íƒ€ë ‰ìŠ¤ B', dep: '2/23(ì›”) ì €ë… 19:40', ret: '2/24(í™”) ì €ë…', members: ["ê°•ì§€ìŠ¹", "ì†í˜•í™˜", "ìµœì˜í˜„", "í™©ê·œì—°", "ë…¸ìš°ì„", "ì„œë¶€ì„", "ë¬¸ì„±í˜"] },
                { gid: 'c3', type: 'ìŠ¤íƒ€ë¦¬ì•„ C', dep: '2/24(í™”) ì €ë… 19:30', ret: '2/25(ìˆ˜) ì˜¤ì „', members: ["ì¥ì„¸í˜", "ê¹€ìƒì¤€", "ê¹€ìŠ¹ì™„", "ê¹€ìš©ì„±", "ì°¨ë™ì² ", "ê¹€ìš©ê±¸"] }
            ];
            churchGroups.forEach(g => {
                g.members.forEach(name => {
                    data.push({ id: `c-${name}`, name, vehicleType: 'êµíšŒì°¨ëŸ‰', groupId: g.gid, isDriver: false, departure: g.dep, return: g.ret, details: `${g.type} ì´ìš©` });
                });
            });

            return data;
        };

        const DeleteConfirm = ({ name, onConfirm, onCancel }) => (
            <div className="fixed inset-0 z-[300] flex items-center justify-center p-6 bg-slate-900/60 backdrop-blur-sm no-print" onClick={onCancel}>
                <div className="bg-white w-full max-w-xs rounded-3xl overflow-hidden shadow-2xl animate-pop" onClick={e => e.stopPropagation()}>
                    <div className="p-8 text-center">
                        <div className="w-16 h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">âš ï¸</div>
                        <h3 className="text-xl font-black mb-2">ì •ë§ ì‚­ì œí• ê¹Œìš”?</h3>
                        <p className="text-slate-500 text-sm font-medium leading-relaxed">[{name}] ë‹˜ì„ ëª…ë‹¨ì—ì„œ ì œì™¸í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div className="flex border-t border-slate-100">
                        <button onClick={onCancel} className="flex-1 py-4 font-bold text-slate-400">ì·¨ì†Œ</button>
                        <button onClick={onConfirm} className="flex-1 py-4 font-black text-red-600 border-l border-slate-100">ì‚­ì œ</button>
                    </div>
                </div>
            </div>
        );

        const App = () => {
            const [data, setData] = useState([]);
            const [isAdmin, setIsAdmin] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedItem, setSelectedItem] = useState(null);
            const [confirmId, setConfirmId] = useState(null);
            const [draggedId, setDraggedId] = useState(null);
            const [isSharing, setIsSharing] = useState(false);
            
            const captureRef = useRef(null);

            const [form, setForm] = useState({ name: '', vehicle: 'ì„ ë°œëŒ€', dep: '2/23(ì›”) ì˜¤ì „', ret: '2/25(ìˆ˜) ì˜¤ì „', memo: '' });

            useEffect(() => {
                const saved = localStorage.getItem('retreat_2026_full_v8');
                setData(saved ? JSON.parse(saved) : generateInitialData());
            }, []);

            useEffect(() => {
                if (data.length > 0) localStorage.setItem('retreat_2026_full_v8', JSON.stringify(data));
            }, [data]);

            const stats = useMemo(() => ({
                b1: data.filter(p => p.vehicleType === 'ì„ ë°œëŒ€').length,
                b2: data.filter(p => p.vehicleType === '2í˜¸ì°¨').length,
                b3: data.filter(p => p.vehicleType === '3í˜¸ì°¨').length,
                priv: data.filter(p => p.vehicleType === 'ê°œì¸ì°¨ëŸ‰').length,
                church: data.filter(p => p.vehicleType === 'êµíšŒì°¨ëŸ‰').length,
            }), [data]);

            const searchResults = useMemo(() => {
                if (!searchTerm.trim()) return [];
                return data.filter(p => p.name.includes(searchTerm.trim()));
            }, [data, searchTerm]);

            const handleAdd = (e) => {
                e.preventDefault();
                if (!form.name.trim()) return;
                const busData = data.filter(p => p.vehicleType === form.vehicle);
                let seat = 0;
                const occupied = new Set(busData.map(p => p.seatPosition));
                while (occupied.has(seat)) seat++;

                const newItem = {
                    id: `new-${Date.now()}`,
                    name: form.name.trim(),
                    vehicleType: form.vehicle,
                    departure: form.dep,
                    return: form.ret,
                    details: form.memo,
                    seatPosition: seat,
                    groupId: `group-${Date.now()}`
                };
                setData([newItem, ...data]);
                setForm({ ...form, name: '', memo: '' });
            };

            const handleDrop = (e, vehicle, seat) => {
                e.preventDefault();
                const sid = e.dataTransfer.getData('sid');
                if (!sid) return;
                setData(prev => {
                    const next = [...prev];
                    const sIdx = next.findIndex(p => p.id === sid);
                    const tIdx = next.findIndex(p => p.vehicleType === vehicle && p.seatPosition === seat);
                    const sItem = next[sIdx];
                    if (tIdx !== -1) {
                        const tItem = next[tIdx];
                        next[sIdx] = { ...sItem, vehicleType: vehicle, seatPosition: seat };
                        next[tIdx] = { ...tItem, vehicleType: sItem.vehicleType, seatPosition: sItem.seatPosition };
                    } else {
                        next[sIdx] = { ...sItem, vehicleType: vehicle, seatPosition: seat };
                    }
                    return next;
                });
                setDraggedId(null);
            };

            const handleShare = async () => {
                if (!captureRef.current) return;
                setIsSharing(true);
                
                try {
                    const canvas = await html2canvas(captureRef.current, {
                        useCORS: true,
                        scale: 2,
                        backgroundColor: '#f8fafc',
                        ignoreElements: (element) => element.classList.contains('no-print')
                    });
                    
                    const dataUrl = canvas.toDataURL('image/png');
                    const blob = await (await fetch(dataUrl)).blob();
                    const file = new File([blob], '2026_ìˆ˜ë ¨íšŒ_ì°¨ëŸ‰ë°°ì •.png', { type: 'image/png' });

                    if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                        await navigator.share({
                            files: [file],
                            title: '2026 ì „ë„ì¸ ìˆ˜ë ¨íšŒ ì°¨ëŸ‰ë°°ì •',
                            text: 'ì°¨ëŸ‰ ë°°ì • í˜„í™© ê³µìœ ë“œë¦½ë‹ˆë‹¤.',
                        });
                    } else {
                        const link = document.createElement('a');
                        link.href = dataUrl;
                        link.download = '2026_ìˆ˜ë ¨íšŒ_ì°¨ëŸ‰ë°°ì •.png';
                        link.click();
                    }
                } catch (err) {
                    console.error('ê³µìœ  ì‹¤íŒ¨:', err);
                    alert('ì´ë¯¸ì§€ ìƒì„± ë˜ëŠ” ê³µìœ  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setIsSharing(false);
                }
            };

            const renderBus = (type) => {
                const members = data.filter(p => p.vehicleType === type);
                const capacity = type === '2í˜¸ì°¨' ? 48 : 48; // í–‰ 12ê°œ x 4ì—´

                return (
                    <div className="bus-container animate-pop">
                        <div className="bus-head">
                            <div className="w-10 h-10 bg-slate-200 rounded-full flex items-center justify-center text-xs font-black">ìš´ì „</div>
                            <div className="w-10 h-10 border-2 border-slate-200 rounded-lg flex items-center justify-center text-[10px] font-bold text-slate-300">ì…êµ¬</div>
                        </div>
                        <h4 className="text-center font-black text-xl mb-6 text-slate-800">{type}</h4>
                        <div className="flex justify-center gap-1">
                            <div className="grid grid-cols-2 gap-1 flex-1">
                                {Array.from({ length: 12 }).map((_, r) => [0, 1].map(c => {
                                    const seatIdx = r * 4 + c;
                                    const p = members.find(m => m.seatPosition === seatIdx);
                                    const isMatch = searchTerm.trim() !== '' && p?.name.includes(searchTerm.trim());
                                    return (
                                        <div key={seatIdx} 
                                            onDragOver={e => e.preventDefault()} 
                                            onDrop={e => handleDrop(e, type, seatIdx)}
                                            className={`seat ${p ? 'seat-occupied' : 'seat-empty'} ${draggedId === p?.id ? 'opacity-20' : ''} ${isMatch ? 'seat-highlight' : ''}`}
                                            draggable={isAdmin && !!p}
                                            onDragStart={e => { setDraggedId(p.id); e.dataTransfer.setData('sid', p.id); }}
                                            onClick={() => p && setSelectedItem(p)}
                                        >
                                            {p?.name}
                                            {isAdmin && p && (
                                                <button onClick={(e) => { e.stopPropagation(); setConfirmId(p.id); }} className="seat-delete-btn no-print">âœ•</button>
                                            )}
                                        </div>
                                    );
                                }))}
                            </div>
                            <div className="aisle"></div>
                            <div className="grid grid-cols-2 gap-1 flex-1">
                                {Array.from({ length: 12 }).map((_, r) => [2, 3].map(c => {
                                    const seatIdx = r * 4 + c;
                                    const p = members.find(m => m.seatPosition === seatIdx);
                                    const isMatch = searchTerm.trim() !== '' && p?.name.includes(searchTerm.trim());
                                    return (
                                        <div key={seatIdx} 
                                            onDragOver={e => e.preventDefault()} 
                                            onDrop={e => handleDrop(e, type, seatIdx)}
                                            className={`seat ${p ? 'seat-occupied' : 'seat-empty'} ${draggedId === p?.id ? 'opacity-20' : ''} ${isMatch ? 'seat-highlight' : ''}`}
                                            draggable={isAdmin && !!p}
                                            onDragStart={e => { setDraggedId(p.id); e.dataTransfer.setData('sid', p.id); }}
                                            onClick={() => p && setSelectedItem(p)}
                                        >
                                            {p?.name}
                                            {isAdmin && p && (
                                                <button onClick={(e) => { e.stopPropagation(); setConfirmId(p.id); }} className="seat-delete-btn no-print">âœ•</button>
                                            )}
                                        </div>
                                    );
                                }))}
                            </div>
                        </div>
                    </div>
                );
            };

            const otherPassengers = useMemo(() => {
                if (!selectedItem || !selectedItem.groupId) return [];
                return data.filter(p => p.groupId === selectedItem.groupId && p.id !== selectedItem.id);
            }, [selectedItem, data]);

            return (
                <div className="max-w-6xl mx-auto px-4 py-8 pb-32">
                    {isSharing && (
                        <div className="loading-overlay">
                            <div className="spinner"></div>
                            <p className="font-black text-xl animate-pulse">ì´ë¯¸ì§€ ìƒì„± ì¤‘...</p>
                        </div>
                    )}

                    <header className="flex flex-col sm:flex-row justify-between items-center mb-10 no-print gap-4">
                        <div>
                            <h1 className="text-3xl font-black text-slate-900 tracking-tighter text-center sm:text-left">2026 ì „ë„ì¸ ìˆ˜ë ¨íšŒ <span className="text-blue-600">ì°¨ëŸ‰ìš´ì˜</span></h1>
                            <p className="text-xs font-bold text-slate-400 uppercase tracking-widest text-center sm:text-left">Evangelist Retreat Dashboard</p>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setIsAdmin(!isAdmin)} className={`px-4 py-2 rounded-xl font-black text-[10px] shadow-sm transition-all ${isAdmin ? 'bg-slate-200 text-slate-600' : 'bg-slate-800 text-white'}`}>
                                {isAdmin ? 'ADMIN MODE' : 'VIEW MODE'}
                            </button>
                            <button onClick={handleShare} className="px-6 py-3 rounded-2xl font-black text-xs shadow-xl bg-blue-600 text-white active:scale-95 transition-all">
                                ğŸ“¤ ê³µìœ 
                            </button>
                        </div>
                    </header>

                    <div ref={captureRef} id="capture-area" className="bg-transparent p-2">
                        <div className="hidden print:block mb-8 text-center border-b-4 border-slate-900 pb-4">
                            <h1 className="text-4xl font-black mb-1">2026 ì „ë„ì¸ ìˆ˜ë ¨íšŒ ì°¨ëŸ‰ ë°°ì • í˜„í™©</h1>
                            <p className="text-slate-500 font-bold">ì‘ì„± ì¼ì‹œ: {new Date().toLocaleDateString()} {new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                        </div>

                        {isAdmin && (
                            <section className="bg-white p-8 rounded-[40px] shadow-2xl border border-slate-100 mb-12 animate-pop no-print">
                                <h3 className="text-sm font-black text-slate-400 uppercase mb-6 flex items-center gap-2">
                                    <span className="w-2 h-2 bg-blue-500 rounded-full"></span> ì‹ ê·œ ë°°ì • ë“±ë¡
                                </h3>
                                <form onSubmit={handleAdd} className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="space-y-4">
                                        <input type="text" placeholder="ì„±í•¨" value={form.name} onChange={e => setForm({...form, name: e.target.value})} className="w-full h-14 px-6 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold outline-none focus:border-blue-500 transition-colors" />
                                        <select value={form.vehicle} onChange={e => setForm({...form, vehicle: e.target.value})} className="w-full h-14 px-6 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold outline-none">
                                            {['ì„ ë°œëŒ€', '2í˜¸ì°¨', '3í˜¸ì°¨', 'ê°œì¸ì°¨ëŸ‰', 'êµíšŒì°¨ëŸ‰'].map(v => <option key={v}>{v}</option>)}
                                        </select>
                                    </div>
                                    <div className="space-y-4">
                                        <div className="flex gap-2">
                                            <select value={form.dep} onChange={e => setForm({...form, dep: e.target.value})} className="flex-1 h-14 px-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-sm">
                                                {TIME_OPTIONS.map(t => <option key={t}>{t}</option>)}
                                            </select>
                                            <select value={form.ret} onChange={e => setForm({...form, ret: e.target.value})} className="flex-1 h-14 px-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-sm">
                                                {TIME_OPTIONS.map(t => <option key={t}>{t}</option>)}
                                            </select>
                                        </div>
                                        <input type="text" placeholder="ë©”ëª¨" value={form.memo} onChange={e => setForm({...form, memo: e.target.value})} className="w-full h-14 px-6 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold outline-none" />
                                    </div>
                                    <button className="md:col-span-2 h-16 bg-blue-600 text-white rounded-2xl font-black text-lg shadow-xl active:scale-[0.98] transition-all">ë°°ì • ì™„ë£Œ</button>
                                </form>
                            </section>
                        )}

                        <div className="relative mb-12 group no-print">
                            <input type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì—¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì„¸ìš”..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full h-20 bg-white border-4 border-slate-100 rounded-full px-16 font-black text-xl shadow-2xl outline-none focus:border-blue-500 transition-all" />
                            <div className="absolute left-6 top-1/2 -translate-y-1/2 text-2xl opacity-20">ğŸ”</div>
                        </div>

                        {searchTerm.trim() !== '' && (
                            <div className="mb-12 bg-blue-50 border-2 border-blue-100 p-6 rounded-[32px] animate-pop no-print">
                                <h4 className="text-sm font-black text-blue-400 uppercase mb-4">'{searchTerm}' ê²€ìƒ‰ ê²°ê³¼ ({searchResults.length}ê±´)</h4>
                                <div className="flex flex-wrap gap-2">
                                    {searchResults.map(p => (
                                        <button key={p.id} onClick={() => setSelectedItem(p)} className="bg-white border-2 border-blue-200 px-4 py-2 rounded-full text-sm font-black text-blue-600 hover:bg-blue-600 hover:text-white transition-all shadow-sm">
                                            {p.name} ({p.vehicleType})
                                        </button>
                                    ))}
                                    {searchResults.length === 0 && <p className="text-slate-400 font-bold text-sm">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>}
                                </div>
                            </div>
                        )}

                        <div className="flex justify-around mb-16 text-center">
                            <div><p className="text-[10px] font-black text-slate-300">ë²„ìŠ¤ í•©ê³„</p><p className="text-2xl font-black">{stats.b1+stats.b2+stats.b3}</p></div>
                            <div><p className="text-[10px] font-black text-slate-300">ê°œì¸ì°¨ëŸ‰</p><p className="text-2xl font-black text-emerald-500">{stats.priv}</p></div>
                            <div><p className="text-[10px] font-black text-slate-300">êµíšŒì°¨ëŸ‰</p><p className="text-2xl font-black text-amber-500">{stats.church}</p></div>
                        </div>

                        <section className="mb-20">
                            <h2 className="text-2xl font-black text-slate-800 mb-10 border-l-8 border-blue-500 pl-4">ğŸšŒ ë²„ìŠ¤ íƒ‘ìŠ¹ ì¢Œì„ë„</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                                {renderBus('ì„ ë°œëŒ€')}{renderBus('2í˜¸ì°¨')}{renderBus('3í˜¸ì°¨')}
                            </div>
                        </section>

                        <section>
                            <h2 className="text-2xl font-black text-slate-800 mb-10 border-l-8 border-slate-200 pl-4">ğŸš— ê¸°íƒ€ ì°¨ëŸ‰ ë°°ì • í˜„í™©</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                {['ê°œì¸ì°¨ëŸ‰', 'êµíšŒì°¨ëŸ‰'].map(cat => {
                                    const list = data.filter(p => p.vehicleType === cat && (searchTerm.trim() === '' || p.name.includes(searchTerm.trim())));
                                    if (list.length === 0 && searchTerm.trim() === '') return null;
                                    return (
                                        <div key={cat} className="mb-8">
                                            <h3 className={`text-lg font-black mb-6 px-4 py-2 inline-block rounded-xl ${cat === 'ê°œì¸ì°¨ëŸ‰' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}`}>{cat}</h3>
                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                                {list.map(p => (
                                                    <div key={p.id} className="bg-white p-6 rounded-[32px] border-2 border-slate-50 shadow-sm hover:shadow-xl transition-all cursor-pointer group" onClick={() => setSelectedItem(p)}>
                                                        <div className="flex justify-between items-start">
                                                            <div>
                                                                <div className="flex items-center gap-2 mb-2">
                                                                    <span className="text-xl font-black text-slate-800">{p.name}</span>
                                                                    {p.isDriver && <span className="bg-red-500 text-white text-[8px] px-1.5 py-0.5 rounded-md font-black">DRIVER</span>}
                                                                </div>
                                                                <div className="flex flex-col gap-1">
                                                                    <span className="text-[11px] font-black text-blue-600 bg-blue-50 px-2 py-0.5 rounded-lg w-fit">ì¶œë°œ: {p.departure}</span>
                                                                    <p className="text-[10px] font-bold text-slate-400 line-clamp-1">{p.details}</p>
                                                                </div>
                                                            </div>
                                                            {isAdmin && <button onClick={e => { e.stopPropagation(); setConfirmId(p.id); }} className="text-slate-200 hover:text-red-500 text-xl transition-colors no-print">âœ•</button>}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </section>
                    </div>

                    {confirmId && <DeleteConfirm name={data.find(p => p.id === confirmId)?.name} onConfirm={() => { setData(d => d.filter(p => p.id !== confirmId)); setConfirmId(null); }} onCancel={() => setConfirmId(null)} />}
                    
                    {selectedItem && (
                        <div className="fixed inset-0 z-[150] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md no-print" onClick={() => setSelectedItem(null)}>
                            <div className="bg-white w-full max-w-lg rounded-[40px] overflow-hidden shadow-2xl animate-pop" onClick={e => e.stopPropagation()}>
                                <div className={`p-10 ${selectedItem.vehicleType === 'ê°œì¸ì°¨ëŸ‰' ? 'bg-emerald-500' : selectedItem.vehicleType === 'êµíšŒì°¨ëŸ‰' ? 'bg-amber-500' : 'bg-blue-600'} text-white relative`}>
                                    <button onClick={() => setSelectedItem(null)} className="absolute top-6 right-6 w-10 h-10 flex items-center justify-center bg-black/10 rounded-full text-xl font-black">âœ•</button>
                                    <h4 className="text-[10px] font-black uppercase tracking-widest opacity-60 mb-2">{selectedItem.vehicleType}</h4>
                                    <h2 className="text-5xl font-black">{selectedItem.name}</h2>
                                </div>
                                <div className="p-10 space-y-8 max-h-[60vh] overflow-y-auto">
                                    <div className="grid grid-cols-2 gap-6">
                                        <div><p className="text-[10px] font-black text-slate-300 uppercase mb-2">Departure</p><p className="text-lg font-black text-slate-800">{selectedItem.departure}</p></div>
                                        <div><p className="text-[10px] font-black text-slate-300 uppercase mb-2">Return</p><p className="text-lg font-black text-slate-800">{selectedItem.return}</p></div>
                                    </div>
                                    
                                    <div>
                                        <p className="text-[10px] font-black text-slate-300 uppercase mb-2">Vehicle Info</p>
                                        <p className="text-xl font-bold text-slate-600 leading-relaxed">{selectedItem.details || 'ì¶”ê°€ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.'}</p>
                                    </div>

                                    {otherPassengers.length > 0 && (
                                        <div className="pt-6 border-t border-slate-100">
                                            <p className="text-[10px] font-black text-slate-300 uppercase mb-4">ë™ìŠ¹ì ({otherPassengers.length}ëª…)</p>
                                            <div className="flex flex-wrap gap-2">
                                                {otherPassengers.map(op => (
                                                    <span key={op.id} className="bg-slate-50 border border-slate-100 px-4 py-2 rounded-full text-sm font-black text-slate-700">{op.name}</span>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    <button onClick={() => setSelectedItem(null)} className="w-full py-5 bg-slate-900 text-white rounded-2xl font-black active:scale-95 transition-all">í™•ì¸</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
